---
title: Migrazioni Code First in Entity Framework 6 - ambienti di Team
author: divega
ms.date: 2016-10-23
ms.assetid: 4c2d9a95-de6f-4e97-9738-c1f8043eff69
ms.openlocfilehash: 31f8476c64d36d4d1cf3d18deb59ebc482dcc975
ms.sourcegitcommit: 0d36e8ff0892b7f034b765b15e041f375f88579a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/09/2018
ms.locfileid: "44251232"
---
# <a name="code-first-migrations-in-team-environments"></a><span data-ttu-id="2a7f0-102">Migrazioni Code First in ambienti di Team</span><span class="sxs-lookup"><span data-stu-id="2a7f0-102">Code First Migrations in Team Environments</span></span>
> [!NOTE]
> <span data-ttu-id="2a7f0-103">Questo articolo presuppone che l'utente sappia usare migrazioni Code First in scenari di base.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-103">This article assumes you know how to use Code First Migrations in basic scenarios.</span></span> <span data-ttu-id="2a7f0-104">Se in caso contrario, allora sarà necessario leggere [migrazioni Code First](~/ef6/modeling/code-first/migrations/index.md) prima di continuare.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-104">If you don’t, then you’ll need to read [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md) before continuing.</span></span>

## <a name="grab-a-coffee-you-need-to-read-this-whole-article"></a><span data-ttu-id="2a7f0-105">Scarica un caffè, è necessario leggere questo articolo completo</span><span class="sxs-lookup"><span data-stu-id="2a7f0-105">Grab a coffee, you need to read this whole article</span></span>

<span data-ttu-id="2a7f0-106">I problemi negli ambienti di team sono prevalentemente riguardo l'unione, le migrazioni quando due sviluppatori hanno generato le migrazioni di base di codice locale.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-106">The issues in team environments are mostly around merging migrations when two developers have generated migrations in their local code base.</span></span> <span data-ttu-id="2a7f0-107">Anche se i passaggi per risolvere questi sono piuttosto semplici, è necessario avere una conoscenza approfondita del funzionamento di migrazioni richiedono.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-107">While the steps to solve these are pretty simple, they require you to have a solid understanding of how migrations works.</span></span> <span data-ttu-id="2a7f0-108">Non semplicemente passare direttamente alla fine, il tempo necessario per leggere l'intero articolo per verificare che l'operazione ha esito positivo.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-108">Please don’t just skip ahead to the end – take the time to read the whole article to ensure you are successful.</span></span>

## <a name="some-general-guidelines"></a><span data-ttu-id="2a7f0-109">Linee guida generali</span><span class="sxs-lookup"><span data-stu-id="2a7f0-109">Some general guidelines</span></span>

<span data-ttu-id="2a7f0-110">Prima di approfondire come gestire le migrazioni unione generate da più sviluppatori, ecco alcune linee guida generali per raggiungere risultati di successo.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-110">Before we dig into how to manage merging migrations generated by multiple developers, here are some general guidelines to set you up for success.</span></span>

### <a name="each-team-member-should-have-a-local-development-database"></a><span data-ttu-id="2a7f0-111">Ogni membro del team deve avere un database di sviluppo locale</span><span class="sxs-lookup"><span data-stu-id="2a7f0-111">Each team member should have a local development database</span></span>

<span data-ttu-id="2a7f0-112">Le migrazioni viene utilizzata la  **\_ \_MigrationsHistory** tabella per archiviare le migrazioni sono state applicate al database.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-112">Migrations uses the **\_\_MigrationsHistory** table to store what migrations have been applied to the database.</span></span> <span data-ttu-id="2a7f0-113">Se si devono di più sviluppatori generazione diverse migrazioni durante il tentativo di nello stesso database di destinazione (e pertanto condividono un  **\_ \_MigrationsHistory** tabella) migrazioni dovrà verificare alcuni problemi.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-113">If you have multiple developers generating different migrations while trying to target the same database (and thus share a **\_\_MigrationsHistory** table) migrations is going to get very confused.</span></span>

<span data-ttu-id="2a7f0-114">Naturalmente, se si dispone di membri del team che non verranno generate le migrazioni, è sufficiente che condividono un database centrale di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-114">Of course, if you have team members that aren’t generating migrations, there is no problem having them share a central development database.</span></span>

### <a name="avoid-automatic-migrations"></a><span data-ttu-id="2a7f0-115">Evitare di processi di migrazione automatiche</span><span class="sxs-lookup"><span data-stu-id="2a7f0-115">Avoid automatic migrations</span></span>

<span data-ttu-id="2a7f0-116">La conclusione è che le migrazioni automatiche inizialmente visualizzate correttamente in ambienti di team, ma in realtà semplicemente non funzionano.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-116">The bottom line is that automatic migrations initially look good in team environments, but in reality they just don’t work.</span></span> <span data-ttu-id="2a7f0-117">Se si desidera conoscere la causa, continuare a leggere: in caso contrario, è possibile ignorare la sezione successiva.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-117">If you want to know why, keep reading – if not, then you can skip to the next section.</span></span>

<span data-ttu-id="2a7f0-118">Processi di migrazione automatiche consente di disporre dello schema del database aggiornato in modo da corrispondere al modello corrente senza la necessità di generare file di codice (le migrazioni basate su codice).</span><span class="sxs-lookup"><span data-stu-id="2a7f0-118">Automatic migrations allows you to have your database schema updated to match the current model without the need to generate code files (code-based migrations).</span></span> <span data-ttu-id="2a7f0-119">Processi di migrazione automatiche funzionano molto bene in un ambiente di team mai più usati e mai generato le migrazioni basate su codice.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-119">Automatic migrations would work very well in a team environment if you only ever used them and never generated any code-based migrations.</span></span> <span data-ttu-id="2a7f0-120">Il problema è che le migrazioni automatiche sono limitate e non gestiscono un numero di operazioni: Rinomina proprietà/colonna, lo spostamento dei dati a un'altra tabella, e così via. Per gestire questi scenari si finisce generando le migrazioni basate su codice (e la modifica del codice sottoposto a scaffolding) che vengono combinati tra le modifiche che sono gestite dai processi di migrazione automatiche.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-120">The problem is that automatic migrations are limited and don’t handle a number of operations – property/column renames, moving data to another table, etc. To handle these scenarios you end up generating code-based migrations (and editing the scaffolded code) that are mixed in between changes that are handled by automatic migrations.</span></span> <span data-ttu-id="2a7f0-121">In questo modo è quasi nella comunicazione Impossibile eseguire il merge delle modifiche quando due gli sviluppatori archiviano le migrazioni.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-121">This makes it near on impossible to merge changes when two developers check in migrations.</span></span>

## <a name="screencasts"></a><span data-ttu-id="2a7f0-122">Screencast</span><span class="sxs-lookup"><span data-stu-id="2a7f0-122">Screencasts</span></span>

<span data-ttu-id="2a7f0-123">Se si sarebbe piuttosto guardare uno screencast rispetto a leggere questo articolo, i due video seguenti riguardano lo stesso contenuto in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-123">If you'd rather watch a screencast than read this article, the following two videos cover the same content as this article.</span></span>

### <a name="video-one-migrations---under-the-hood"></a><span data-ttu-id="2a7f0-124">Un video: "Migrazioni - dietro le quinte"</span><span class="sxs-lookup"><span data-stu-id="2a7f0-124">Video One: "Migrations - Under the Hood"</span></span>

<span data-ttu-id="2a7f0-125">[In questo screencast](http://channel9.msdn.com/blogs/ef/migrations-under-the-hood) riguarda la modalità di traccia delle migrazioni e utilizza le informazioni sul modello per rilevare le modifiche al modello.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-125">[This screencast](http://channel9.msdn.com/blogs/ef/migrations-under-the-hood) covers how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="video-two-migrations---team-environments"></a><span data-ttu-id="2a7f0-126">Due video: "Migrazioni - ambienti di Team"</span><span class="sxs-lookup"><span data-stu-id="2a7f0-126">Video Two: "Migrations - Team Environments"</span></span>

<span data-ttu-id="2a7f0-127">I concetti del video precedente, di compilazione [questo screencast](http://channel9.msdn.com/blogs/ef/migrations-team-environments) vengono illustrati i problemi che si verificano in un ambiente di team e come risolverli.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-127">Building on the concepts from the previous video, [this screencast](http://channel9.msdn.com/blogs/ef/migrations-team-environments) covers the issues that arise in a team environment and how to solve them.</span></span>

## <a name="understanding-how-migrations-works"></a><span data-ttu-id="2a7f0-128">Comprendere il funzionamento delle migrazioni</span><span class="sxs-lookup"><span data-stu-id="2a7f0-128">Understanding how migrations works</span></span>

<span data-ttu-id="2a7f0-129">La chiave per l'utilizzo corretto delle migrazioni in un ambiente di team è una semplice comprendere come tiene traccia delle migrazioni e Usa le informazioni sul modello per rilevare le modifiche al modello.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-129">The key to successfully using migrations in a team environment is a basic understanding how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="the-first-migration"></a><span data-ttu-id="2a7f0-130">La prima migrazione</span><span class="sxs-lookup"><span data-stu-id="2a7f0-130">The first migration</span></span>

<span data-ttu-id="2a7f0-131">Quando si aggiunge la prima migrazione al progetto, si esegue simile **Add-Migration prima** nella Console di gestione pacchetti.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-131">When you add the first migration to your project, you run something like **Add-Migration First** in Package Manager Console.</span></span> <span data-ttu-id="2a7f0-132">I passaggi di alto livello che esegue questo comando sono illustrati in precedenza.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-132">The high level steps that this command performs are pictured below.</span></span>

![Prima della migrazione](~/ef6/media/firstmigration.png)

<span data-ttu-id="2a7f0-134">Il modello corrente viene calcolato dal codice (1).</span><span class="sxs-lookup"><span data-stu-id="2a7f0-134">The current model is calculated from your code (1).</span></span> <span data-ttu-id="2a7f0-135">Gli oggetti di database necessari vengono quindi calcolati le differenze tra modelli (2): poiché si tratta della prima migrazione il modello sono diversi usi soli un modello vuoto per il confronto.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-135">The required database objects are then calculated by the model differ (2) – since this is the first migration the model differ just uses an empty model for the comparison.</span></span> <span data-ttu-id="2a7f0-136">Le modifiche necessarie vengono passate al generatore di codice per compilare il codice di migrazione necessarie (3) che viene quindi aggiunto alla soluzione Visual Studio (4).</span><span class="sxs-lookup"><span data-stu-id="2a7f0-136">The required changes are passed to the code generator to build the required migration code (3) which is then added to your Visual Studio solution (4).</span></span>

<span data-ttu-id="2a7f0-137">Oltre al codice di migrazione effettivo che viene archiviato nel file di codice principale, le migrazioni genera inoltre un file code-behind aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-137">In addition to the actual migration code that is stored in the main code file, migrations also generates some additional code-behind files.</span></span> <span data-ttu-id="2a7f0-138">Questi file sono metadati che viene usato per le migrazioni e non sono un elemento che è consigliabile modificare.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-138">These files are metadata that is used by migrations and are not something you should edit.</span></span> <span data-ttu-id="2a7f0-139">Uno di questi file è un file di risorse (resx) che contiene uno snapshot del modello al momento che della migrazione è stata generata.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-139">One of these files is a resource file (.resx) that contains a snapshot of the model at the time the migration was generated.</span></span> <span data-ttu-id="2a7f0-140">Si noterà come viene usato nel passaggio successivo.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-140">You’ll see how this is used in the next step.</span></span>

<span data-ttu-id="2a7f0-141">A questo punto è probabilmente verrebbe eseguito **Update-Database** per rendere effettive le modifiche al database e quindi passare sull'implementazione di altre aree dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-141">At this point you would probably run **Update-Database** to apply your changes to the database, and then go about implementing other areas of your application.</span></span>

### <a name="subsequent-migrations"></a><span data-ttu-id="2a7f0-142">Migrazioni successive</span><span class="sxs-lookup"><span data-stu-id="2a7f0-142">Subsequent migrations</span></span>

<span data-ttu-id="2a7f0-143">In un secondo momento si tornare indietro e apportare alcune modifiche al modello: in questo esempio si aggiungerà un **Url** proprietà **Blog**.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-143">Later you come back and make some changes to your model – in our example we’ll add a **Url** property to **Blog**.</span></span> <span data-ttu-id="2a7f0-144">È quindi necessario eseguire un comando, ad esempio **Add-Migration AddUrl** per eseguire lo scaffolding di una migrazione per il database corrispondente di applicare le modifiche.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-144">You would then issue a command such as **Add-Migration AddUrl** to scaffold a migration to apply the corresponding database changes.</span></span> <span data-ttu-id="2a7f0-145">I passaggi di alto livello che esegue questo comando sono illustrati in precedenza.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-145">The high level steps that this command performs are pictured below.</span></span>

![Seconda migrazione](~/ef6/media/secondmigration.png)

<span data-ttu-id="2a7f0-147">Come in precedenza, il modello corrente viene calcolato dal codice (1).</span><span class="sxs-lookup"><span data-stu-id="2a7f0-147">Just like last time, the current model is calculated from code (1).</span></span> <span data-ttu-id="2a7f0-148">Tuttavia, questa volta sono presenti le migrazioni esistenti in modo che il modello precedente viene recuperato dalla migrazione più recente (2).</span><span class="sxs-lookup"><span data-stu-id="2a7f0-148">However, this time there are existing migrations so the previous model is retrieved from the latest migration (2).</span></span> <span data-ttu-id="2a7f0-149">Questi due modelli sono addedgroups per trovare le modifiche del database necessarie (3) e quindi il completamento del processo come indicato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-149">These two models are diffed to find the required database changes (3) and then the process completes as before.</span></span>

<span data-ttu-id="2a7f0-150">Questo stesso processo viene usato per eventuali altre migrazioni aggiunti al progetto.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-150">This same process is used for any further migrations that you add to the project.</span></span>

### <a name="why-bother-with-the-model-snapshot"></a><span data-ttu-id="2a7f0-151">Perché è necessario eseguire lo snapshot del modello?</span><span class="sxs-lookup"><span data-stu-id="2a7f0-151">Why bother with the model snapshot?</span></span>

<span data-ttu-id="2a7f0-152">Si potrebbe chiedere perché EF anche con lo snapshot del modello: il motivo per cui non solo esaminare il database.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-152">You may be wondering why EF bothers with the model snapshot – why not just look at the database.</span></span> <span data-ttu-id="2a7f0-153">In questo caso, continuare a leggere.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-153">If so, read on.</span></span> <span data-ttu-id="2a7f0-154">Se non si è interessati è possibile ignorare questa sezione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-154">If you’re not interested then you can skip this section.</span></span>

<span data-ttu-id="2a7f0-155">Esistono diversi motivi, a che Entity Framework mantiene lo snapshot modello intorno:</span><span class="sxs-lookup"><span data-stu-id="2a7f0-155">There are a number of reasons EF keeps the model snapshot around:</span></span>

-   <span data-ttu-id="2a7f0-156">Consente il database dello sfasamento dal modello di Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-156">It allows your database to drift from the EF model.</span></span> <span data-ttu-id="2a7f0-157">È possibile apportare queste modifiche direttamente nel database oppure è possibile modificare il codice con scaffolding nelle migrazioni per apportare le modifiche.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-157">These changes can be made directly in the database, or you can change the scaffolded code in your migrations to make the changes.</span></span> <span data-ttu-id="2a7f0-158">Ecco alcuni esempi di ciò in pratica:</span><span class="sxs-lookup"><span data-stu-id="2a7f0-158">Here are a couple of examples of this in practice:</span></span>
    -   <span data-ttu-id="2a7f0-159">Si desidera aggiungere un inserite e aggiornate alla colonna a una o più delle tabelle, ma non si vuole includere queste colonne nel modello di Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-159">You want to add an Inserted and Updated to column to one or more of your tables but you don’t want to include these columns in the EF model.</span></span> <span data-ttu-id="2a7f0-160">Se le migrazioni preso in esame il database che verrebbe continuamente tenta di eliminare queste colonne ogni volta che è stato eseguito lo scaffolding di una migrazione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-160">If migrations looked at the database it would continually try to drop these columns every time you scaffolded a migration.</span></span> <span data-ttu-id="2a7f0-161">Usa lo snapshot del modello, Entity Framework rileverà unicamente legittime modifiche al modello.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-161">Using the model snapshot, EF will only ever detect legitimate changes to the model.</span></span>
    -   <span data-ttu-id="2a7f0-162">Si desidera modificare il corpo di una stored procedure usata per gli aggiornamenti da includere alcune registrazioni.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-162">You want to change the body of a stored procedure used for updates to include some logging.</span></span> <span data-ttu-id="2a7f0-163">Se le migrazioni esaminato questa stored procedure dal database tenterebbe continuamente di ripristinare la definizione che si aspetta di Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-163">If migrations looked at this stored procedure from the database it would continually try and reset it back to the definition that EF expects.</span></span> <span data-ttu-id="2a7f0-164">Usando lo snapshot del modello, Entity Framework sempre eseguirà lo scaffolding di codice per modificare la stored procedure quando si modifica la forma della procedura nel modello di Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-164">By using the model snapshot, EF will only ever scaffold code to alter the stored procedure when you change the shape of the procedure in the EF model.</span></span>
    -   <span data-ttu-id="2a7f0-165">Questi stessi principi valgono per l'aggiunta di indici aggiuntivi, incluse le tabelle aggiuntive nel database, il mapping di Entity Framework per una vista di database che si trova su una tabella e così via.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-165">These same principles apply to adding extra indexes, including extra tables in your database, mapping EF to a database view that sits over a table, etc.</span></span>
-   <span data-ttu-id="2a7f0-166">Il modello di Entity Framework contiene solo la forma del database.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-166">The EF model contains more than just the shape of the database.</span></span> <span data-ttu-id="2a7f0-167">L'intero modello consente migrazioni esaminare le informazioni sulle proprietà e le classi nel modello e sul relativo mapping alle tabelle e colonne.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-167">Having the entire model allows migrations to look at information about the properties and classes in your model and how they map to the columns and tables.</span></span> <span data-ttu-id="2a7f0-168">Queste informazioni consentono di essere più intelligente nel codice che esegue lo scaffolding delle migrazioni.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-168">This information allows migrations to be more intelligent in the code that it scaffolds.</span></span> <span data-ttu-id="2a7f0-169">Ad esempio, se si modifica il nome della colonna che esegue il mapping di una proprietà per le migrazioni possa rilevare la ridenominazione dalla che è la stessa proprietà – qualcosa che non può essere eseguita se si ha solo lo schema del database.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-169">For example, if you change the name of the column that a property maps to migrations can detect the rename by seeing that it’s the same property – something that can’t be done if you only have the database schema.</span></span> 

## <a name="what-causes-issues-in-team-environments"></a><span data-ttu-id="2a7f0-170">Qual è la causa problemi negli ambienti di team</span><span class="sxs-lookup"><span data-stu-id="2a7f0-170">What causes issues in team environments</span></span>

<span data-ttu-id="2a7f0-171">Il flusso di lavoro illustrati nel funzionamento della sezione precedente ideale quando si è un singolo sviluppatore che lavora in un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-171">The workflow covered in the previous section works great when you are a single developer working on an application.</span></span> <span data-ttu-id="2a7f0-172">Funziona anche in un ambiente con team se si è l'unica persona ad apportare modifiche al modello.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-172">It also works well in a team environment if you are the only person making changes to the model.</span></span> <span data-ttu-id="2a7f0-173">In questo scenario è possibile apportare modifiche al modello, generare le migrazioni e inviarli al controllo del codice sorgente.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-173">In this scenario you can make model changes, generate migrations and submit them to your source control.</span></span> <span data-ttu-id="2a7f0-174">Altri sviluppatori possono sincronizzare le modifiche ed eseguire **Update-Database** affinché le modifiche dello schema applicate.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-174">Other developers can sync your changes and run **Update-Database** to have the schema changes applied.</span></span>

<span data-ttu-id="2a7f0-175">I problemi danno avvio a cui si verificano quando si devono di più sviluppatori apportano modifiche al modello di Entity Framework e l'invio di controllo del codice sorgente nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-175">Issues start to arise when you have multiple developers making changes to the EF model and submitting to source control at the same time.</span></span> <span data-ttu-id="2a7f0-176">Ciò che non dispone di Entity Framework è un modo eccellente per unire le migrazioni locali con le migrazioni che un altro sviluppatore è inviata al controllo del codice sorgente perché ultima sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-176">What EF lacks is a first class way to merge your local migrations with migrations that another developer has submitted to source control since you last synced.</span></span>

## <a name="an-example-of-a-merge-conflict"></a><span data-ttu-id="2a7f0-177">Un esempio di un conflitto di merge</span><span class="sxs-lookup"><span data-stu-id="2a7f0-177">An example of a merge conflict</span></span>

<span data-ttu-id="2a7f0-178">Primo verrà ora esaminato un esempio concreto di un conflitto di merge.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-178">First let’s look at a concrete example of such a merge conflict.</span></span> <span data-ttu-id="2a7f0-179">Microsoft continuerà in con l'esempio che è stato esaminato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-179">We’ll continue on with the example we looked at earlier.</span></span> <span data-ttu-id="2a7f0-180">Come un avvio di un punto si presuppongono le modifiche nella sezione precedente sono state archiviate dallo sviluppatore dell'originale.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-180">As a starting point let’s assume the changes from the previous section were checked in by the original developer.</span></span> <span data-ttu-id="2a7f0-181">Si terrà traccia due sviluppatori quando si apportano modifiche al codice base.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-181">We’ll track two developers as they make changes to code base.</span></span>

<span data-ttu-id="2a7f0-182">Si terrà traccia il modello di EF e le migrazioni attraverso una serie di modifiche.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-182">We’ll track the EF model and the migrations thru a number of changes.</span></span> <span data-ttu-id="2a7f0-183">Per un punto di partenza, entrambi gli sviluppatori sono sincronizzati con il repository del controllo codice sorgente, come illustrato nella figura seguente.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-183">For a starting point, both developers have synced to the source control repository, as depicted in the following graphic.</span></span>

![Punto di partenza](~/ef6/media/startingpoint.png)

<span data-ttu-id="2a7f0-185">Per gli sviluppatori \#1 e per gli sviluppatori \#2 ora apporta alcune modifiche al modello di Entity Framework nel proprio codice locale base.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-185">Developer \#1 and developer \#2 now makes some changes to the EF model in their local code base.</span></span> <span data-ttu-id="2a7f0-186">Per gli sviluppatori \#aggiunge 1 una **Rating** proprietà **Blog** – e genera un **AddRating** migrazione per applicare le modifiche al database.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-186">Developer \#1 adds a **Rating** property to **Blog** – and generates an **AddRating** migration to apply the changes to the database.</span></span> <span data-ttu-id="2a7f0-187">Per gli sviluppatori \#2 aggiunge una **lettori** proprietà **Blog** – e genera il corrispondente **AddReaders** migrazione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-187">Developer \#2 adds a **Readers** property to **Blog** – and generates the corresponding **AddReaders** migration.</span></span> <span data-ttu-id="2a7f0-188">Entrambi gli sviluppatori di eseguire **Update-Database**, per applicare le modifiche ai database locali e quindi continuare a sviluppare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-188">Both developers run **Update-Database**, to apply the changes to their local databases, and then continue developing the application.</span></span>

> [!NOTE]
> <span data-ttu-id="2a7f0-189">Le migrazioni sono precedute da un timestamp, in modo che il nostro grafico rappresenta che la migrazione AddReaders dello sviluppatore \#2 dopo la migrazione AddRating proviene Developer \#1.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-189">Migrations are prefixed with a timestamp, so our graphic represents that the AddReaders migration from Developer \#2 comes after the AddRating migration from Developer \#1.</span></span> <span data-ttu-id="2a7f0-190">Se per gli sviluppatori \#1 o \#2 non generato la stabilita prima migrazione alcuna differenza per i problemi dell'utilizzo di un team o il processo per eseguire il merge che vedremo nella prossima sezione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-190">Whether developer \#1 or \#2 generated the migration first makes no difference to the issues of working in a team, or the process for merging them that we’ll look at in the next section.</span></span>

![Modifiche locali](~/ef6/media/localchanges.png)

<span data-ttu-id="2a7f0-192">È un giorno fortunato per sviluppatore \#1 in tempo reale per inviare le modifiche prima di tutto.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-192">It’s a lucky day for Developer \#1 as they happen to submit their changes first.</span></span> <span data-ttu-id="2a7f0-193">Poiché non ve ne ha archiviato poiché vengono sincronizzati con i repository, può solo inviare le modifiche senza eseguire alcuna operazione di unione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-193">Because no one else has checked in since they synced their repository, they can just submit their changes without performing any merging.</span></span>

![Invia](~/ef6/media/submit.png)

<span data-ttu-id="2a7f0-195">È ora per sviluppatore \#2 da inviare.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-195">Now it’s time for Developer \#2 to submit.</span></span> <span data-ttu-id="2a7f0-196">Non sono pertanto fortunati.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-196">They aren’t so lucky.</span></span> <span data-ttu-id="2a7f0-197">Perché un altro utente ha inviato le modifiche perché sono sincronizzati, dovranno ottenga le modifiche e di tipo merge.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-197">Because someone else has submitted changes since they synced, they will need to pull down the changes and merge.</span></span> <span data-ttu-id="2a7f0-198">Il controllo del codice sorgente probabilmente sarà in grado di unire automaticamente le modifiche a livello di codice perché sono molto semplici.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-198">The source control system will likely be able to automatically merge the changes at the code level since they are very simple.</span></span> <span data-ttu-id="2a7f0-199">Lo stato di sviluppatore \#2 locale del repository dopo la sincronizzazione è illustrata nella figura seguente.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-199">The state of Developer \#2’s local repository after syncing is depicted in the following graphic.</span></span> 

![Eseguire il pull](~/ef6/media/pull.png)

<span data-ttu-id="2a7f0-201">In questa fase per sviluppatori \#2 possono eseguire **Update-Database** cui rileverà il nuovo **AddRating** migrazione (che non sia stata applicata allo sviluppatore \#del 2 database) e applicarlo.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-201">At this stage Developer \#2 can run **Update-Database** which will detect the new **AddRating** migration (which hasn’t been applied to Developer \#2’s database) and apply it.</span></span> <span data-ttu-id="2a7f0-202">A questo punto il **Rating** viene aggiunta la **blog** tabella e il database è sincronizzato con il modello.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-202">Now the **Rating** column is added to the **Blogs** table and the database is in sync with the model.</span></span>

<span data-ttu-id="2a7f0-203">Esistono tuttavia alcuni problemi:</span><span class="sxs-lookup"><span data-stu-id="2a7f0-203">There are a couple of problems though:</span></span>

1.  <span data-ttu-id="2a7f0-204">Sebbene **Update-Database** applicherà le **AddRating** migrazione, verrà anche generato un avviso: *non è possibile aggiornare database in modo che corrisponda al modello corrente perché sono presenti modifiche in sospeso e la migrazione automatica è disabilitata...*</span><span class="sxs-lookup"><span data-stu-id="2a7f0-204">Although **Update-Database** will apply the **AddRating** migration it will also raise a warning: *Unable to update database to match the current model because there are pending changes and automatic migration is disabled…*</span></span>
    <span data-ttu-id="2a7f0-205">Il problema è che lo snapshot del modello archiviato nell'ultima migrazione (**AddReader**) non è presente il **classificazione** proprietà sul **Blog** (poiché non è stato incluso nel modello di quando il la migrazione è stata generata).</span><span class="sxs-lookup"><span data-stu-id="2a7f0-205">The problem is that the model snapshot stored in the last migration (**AddReader**) is missing the **Rating** property on **Blog** (since it wasn’t part of the model when the migration was generated).</span></span> <span data-ttu-id="2a7f0-206">Il codice rileva prima che il modello nell'ultima migrazione non corrisponda al modello corrente e genera l'avviso.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-206">Code First detects that the model in the last migration doesn’t match the current model and raises the warning.</span></span>
2.  <span data-ttu-id="2a7f0-207">Esegue l'applicazione genera un'eccezione InvalidOperationException che indica che "*il modello supporta il contesto 'BloggingContext' è stato modificato dal momento della creazione del database. È consigliabile usare migrazioni Code First per aggiornare il database..."*</span><span class="sxs-lookup"><span data-stu-id="2a7f0-207">Running the application would result in an InvalidOperationException stating that “*The model backing the 'BloggingContext' context has changed since the database was created. Consider using Code First Migrations to update the database…”*</span></span>
    <span data-ttu-id="2a7f0-208">Il problema è anche in questo caso, lo snapshot del modello archiviato nell'ultima migrazione non corrisponda al modello corrente.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-208">Again, the problem is the model snapshot stored in the last migration doesn’t match the current model.</span></span>
3.  <span data-ttu-id="2a7f0-209">Infine, è prevedibile in esecuzione **Add-Migration** ora genera una migrazione vuota (perché non sono presenti modifiche da applicare al database).</span><span class="sxs-lookup"><span data-stu-id="2a7f0-209">Finally, we would expect running **Add-Migration** now would generate an empty migration (since there are no changes to apply to the database).</span></span> <span data-ttu-id="2a7f0-210">Tuttavia, poiché le migrazioni confronta il modello corrente a quello dall'ultima migrazione (che non è presente il **Rating** proprietà) verrà effettivamente lo scaffolding di un'altra **AddColumn** chiamata per aggiungere il **Rating** colonna.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-210">But because migrations compares the current model to the one from the last migration (which is missing the **Rating** property) it will actually scaffold another **AddColumn** call to add in the **Rating** column.</span></span> <span data-ttu-id="2a7f0-211">Naturalmente, questa migrazione avrà esito negativo durante **Update-Database** perché la **Rating** colonna esiste già.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-211">Of course, this migration would fail during **Update-Database** because the **Rating** column already exists.</span></span>

## <a name="resolving-the-merge-conflict"></a><span data-ttu-id="2a7f0-212">Risolvere il conflitto di merge</span><span class="sxs-lookup"><span data-stu-id="2a7f0-212">Resolving the merge conflict</span></span>

<span data-ttu-id="2a7f0-213">La buona notizia è che non è troppo difficile da affrontare il merge manuale, purché tu abbia una conoscenza del funzionamento delle migrazioni.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-213">The good news is that it’s not too hard to deal with the merge manually – provided you have an understanding of how migrations works.</span></span> <span data-ttu-id="2a7f0-214">Pertanto, se è stata ignorata direttamente a questa sezione...</span><span class="sxs-lookup"><span data-stu-id="2a7f0-214">So if you’ve skipped ahead to this section…</span></span> <span data-ttu-id="2a7f0-215">è necessario tornare indietro e leggere prima di tutto il resto dell'articolo.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-215">sorry, you need to go back and read the rest of the article first!</span></span>

<span data-ttu-id="2a7f0-216">Sono disponibili due opzioni, la più semplice consiste nel generare una migrazione vuota con il modello corretto corrente come snapshot.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-216">There are two options, the easiest is to generate a blank migration that has the correct current model as a snapshot.</span></span> <span data-ttu-id="2a7f0-217">La seconda opzione consiste nell'aggiornare lo snapshot nell'ultima migrazione per avere i valori corretti snapshot del modello.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-217">The second option is to update the snapshot in the last migration to have the correct model snapshot.</span></span> <span data-ttu-id="2a7f0-218">La seconda opzione è un po' più difficile e non può essere utilizzata in ogni scenario, ma è anche più chiaro perché, non prevede l'aggiunta di una migrazione aggiuntiva.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-218">The second option is a little harder and can’t be used in every scenario, but it’s also cleaner because it doesn’t involve adding an extra migration.</span></span>

### <a name="option-1-add-a-blank-merge-migration"></a><span data-ttu-id="2a7f0-219">Opzione 1: Aggiungere una migrazione vuota 'merge'</span><span class="sxs-lookup"><span data-stu-id="2a7f0-219">Option 1: Add a blank ‘merge’ migration</span></span>

<span data-ttu-id="2a7f0-220">In questo caso è possibile generare una migrazione vuota esclusivamente allo scopo di garantire la migrazione di più recente è lo snapshot corretto del modello in essa archiviati.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-220">In this option we generate a blank migration solely for the purpose of making sure the latest migration has the correct model snapshot stored in it.</span></span>

<span data-ttu-id="2a7f0-221">Questa opzione è utilizzabile indipendentemente che ha generato l'ultima migrazione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-221">This option can be used regardless of who generated the last migration.</span></span> <span data-ttu-id="2a7f0-222">Nell'esempio è stato seguito Developer \#2 si sta occupando di merge e si sono verificati per generare l'ultima migrazione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-222">In the example we’ve been following Developer \#2 is taking care of the merge and they happened to generate the last migration.</span></span> <span data-ttu-id="2a7f0-223">Ma questi stessi passaggi possono essere utilizzati se per gli sviluppatori \#generato 1 l'ultima migrazione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-223">But these same steps can be used if Developer \#1 generated the last migration.</span></span> <span data-ttu-id="2a7f0-224">I passaggi si applicano anche se sono coinvolti più migrazioni, è stato appena stato esaminando due per mantenerla semplice.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-224">The steps also apply if there are multiple migrations involved – we’ve just been looking at two in order to keep it simple.</span></span>

<span data-ttu-id="2a7f0-225">Per questo approccio, a partire dal momento in cui che si può notare, che è necessario effettuare modifiche che devono essere sincronizzati dal controllo del codice sorgente può essere usata la seguente procedura.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-225">The following process can be used for this approach, starting from the time you realize you have changes that need to be synced from source control.</span></span>

1.  <span data-ttu-id="2a7f0-226">Verificare che eventuali modifiche apportate al modello in sospeso nella base di codice locale sono stati scritti di una migrazione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-226">Ensure any pending model changes in your local code base have been written to a migration.</span></span> <span data-ttu-id="2a7f0-227">In questo modo, che non perdere eventuali modifiche legittime quando giunge il momento per generare la migrazione vuota.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-227">This step ensures you don’t miss any legitimate changes when it comes time to generate the blank migration.</span></span>
2.  <span data-ttu-id="2a7f0-228">Sincronizzazione con controllo del codice sorgente.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-228">Sync with source control.</span></span>
3.  <span data-ttu-id="2a7f0-229">Eseguire **Update-Database** per applicare eventuali migrazioni nuove che sono archiviati altri sviluppatori.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-229">Run **Update-Database** to apply any new migrations that other developers have checked in.</span></span>
    <span data-ttu-id="2a7f0-230">\*\*
    *Nota: \* \* \* se non si ottengono tutti gli avvisi dal comando Update-Database, quindi si sono verificati alcun nuovo migrazioni da altri sviluppatori e non è necessario eseguire alcuna ulteriore operazione di unione.*</span><span class="sxs-lookup"><span data-stu-id="2a7f0-230">\*\*
*Note:\*\*\*\*if you don’t get any warnings from the Update-Database command then there were no new migrations from other developers and there is no need to perform any further merging.*</span></span>
4.  <span data-ttu-id="2a7f0-231">Eseguire **Add-Migration &lt;seleziona\_una\_nome&gt; – IgnoreChanges** (ad esempio, **Merge Add-Migration – IgnoreChanges**).</span><span class="sxs-lookup"><span data-stu-id="2a7f0-231">Run **Add-Migration &lt;pick\_a\_name&gt; –IgnoreChanges** (for example, **Add-Migration Merge –IgnoreChanges**).</span></span> <span data-ttu-id="2a7f0-232">Questo genera una migrazione con tutti i metadati (incluso uno snapshot del modello corrente), ma ignorerà le modifiche viene rilevato durante il confronto dei modelli di corrente in base allo snapshot nelle migrazioni ultimo (vale a dire si ottiene un valore vuoto **backup** e **Verso il basso** (metodo)).</span><span class="sxs-lookup"><span data-stu-id="2a7f0-232">This generates a migration with all the metadata (including a snapshot of the current model) but will ignore any changes it detects when comparing the current model to the snapshot in the last migrations (meaning you get a blank **Up** and **Down** method).</span></span>
5.  <span data-ttu-id="2a7f0-233">Continuare a sviluppare o inviare al controllo del codice sorgente (dopo che eseguono gli unit test naturalmente).</span><span class="sxs-lookup"><span data-stu-id="2a7f0-233">Continue developing, or submit to source control (after running your unit tests of course).</span></span>

<span data-ttu-id="2a7f0-234">Ecco lo stato di sviluppatore \#2 locale del codebase dopo aver usato questo approccio.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-234">Here is the state of Developer \#2’s local code base after using this approach.</span></span>

![Migrazione di tipo merge](~/ef6/media/mergemigration.png)

### <a name="option-2-update-the-model-snapshot-in-the-last-migration"></a><span data-ttu-id="2a7f0-236">Opzione 2: Aggiornare lo snapshot del modello nell'ultima migrazione</span><span class="sxs-lookup"><span data-stu-id="2a7f0-236">Option 2: Update the model snapshot in the last migration</span></span>

<span data-ttu-id="2a7f0-237">Questa opzione è molto simile all'opzione 1, ma rimuove la migrazione: vuota aggiuntive perché parliamoci chiaro, che richiede i file di codice aggiuntivo nella soluzione offerta.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-237">This option is very similar to option 1 but removes the extra blank migration – because let’s face it, who wants extra code files in their solution.</span></span>

<span data-ttu-id="2a7f0-238">**Questo approccio è realizzabile solo se l'ultima migrazione esiste solo nella base di codice locale e non è ancora stato inviato al controllo del codice sorgente (ad esempio, se l'ultima migrazione è stato generato dall'utente che esegue il merge)**.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-238">**This approach is only feasible if the latest migration exists only in your local code base and has not yet been submitted to source control (for example, if the last migration was generated by the user doing the merge)**.</span></span> <span data-ttu-id="2a7f0-239">Modificare i metadati delle migrazioni che altri sviluppatori possono sono già applicati per i database di sviluppo, o addirittura peggio ancora applicato a un database di produzione, può comportare effetti collaterali imprevisti.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-239">Editing the metadata of migrations that other developers may have already applied to their development database – or even worse applied to a production database – can result in unexpected side effects.</span></span> <span data-ttu-id="2a7f0-240">Durante il processo di dobbiamo annullare l'ultima migrazione nel nostro database locale e applicarlo nuovamente con i metadati aggiornati.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-240">During the process we’re going to roll back the last migration in our local database and re-apply it with updated metadata.</span></span>

<span data-ttu-id="2a7f0-241">Mentre l'ultima migrazione deve semplicemente essere nella base non sono previste restrizioni al numero o ordine di migrazioni di procedere, il codice locale.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-241">While the last migration needs to just be in the local code base there are no restrictions to the number or order of migrations that proceed it.</span></span> <span data-ttu-id="2a7f0-242">Possono esserci più migrazioni da più sviluppatori diverse e si applicano gli stessi passaggi, si abbiamo appena stata esaminando due per mantenerla semplice.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-242">There can be multiple migrations from multiple different developers and the same steps apply– we’ve just been looking at two in order to keep it simple.</span></span>

<span data-ttu-id="2a7f0-243">Per questo approccio, a partire dal momento in cui che si può notare, che è necessario effettuare modifiche che devono essere sincronizzati dal controllo del codice sorgente può essere usata la seguente procedura.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-243">The following process can be used for this approach, starting from the time you realize you have changes that need to be synced from source control.</span></span>

1.  <span data-ttu-id="2a7f0-244">Verificare che eventuali modifiche apportate al modello in sospeso nella base di codice locale sono stati scritti di una migrazione.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-244">Ensure any pending model changes in your local code base have been written to a migration.</span></span> <span data-ttu-id="2a7f0-245">In questo modo, che non perdere eventuali modifiche legittime quando giunge il momento per generare la migrazione vuota.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-245">This step ensures you don’t miss any legitimate changes when it comes time to generate the blank migration.</span></span>
2.  <span data-ttu-id="2a7f0-246">Sincronizzazione con il controllo del codice sorgente.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-246">Sync with the source control.</span></span>
3.  <span data-ttu-id="2a7f0-247">Eseguire **Update-Database** per applicare eventuali migrazioni nuove che sono archiviati altri sviluppatori.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-247">Run **Update-Database** to apply any new migrations that other developers have checked in.</span></span>
    <span data-ttu-id="2a7f0-248">\*\*
    *Nota: \* \* \* se non si ottengono tutti gli avvisi dal comando Update-Database, quindi si sono verificati alcun nuovo migrazioni da altri sviluppatori e non è necessario eseguire alcuna ulteriore operazione di unione.*</span><span class="sxs-lookup"><span data-stu-id="2a7f0-248">\*\*
*Note:\*\*\*\*if you don’t get any warnings from the Update-Database command then there were no new migrations from other developers and there is no need to perform any further merging.*</span></span>
4.  <span data-ttu-id="2a7f0-249">Eseguire **Update-Database-TargetMigration &lt;secondo\_ultima\_migrazione&gt;**  (nell'esempio è stato seguito questo sarebbe **Update-Database: TargetMigration AddRating**).</span><span class="sxs-lookup"><span data-stu-id="2a7f0-249">Run **Update-Database –TargetMigration &lt;second\_last\_migration&gt;** (in the example we’ve been following this would be **Update-Database –TargetMigration AddRating**).</span></span> <span data-ttu-id="2a7f0-250">Questo ruoli di cui eseguire il backup il database allo stato del secondo ultima migrazione, in modo efficace 'senza applica' l'ultima migrazione dal database.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-250">This roles the database back to the state of the second last migration – effectively ‘un-applying’ the last migration from the database.</span></span>
    <span data-ttu-id="2a7f0-251">\*\*
    *Nota: \* \* \* questo passaggio è obbligatorio per renderlo più sicuro modificare i metadati della migrazione perché i metadati vengono archiviati anche nel \_ \_MigrationsHistoryTable del database. È per questo motivo è consigliabile usare questa opzione solo se l'ultima migrazione è solo nella base di codici locale. Se altri database era l'ultima migrazione applicata è anche necessario il rollback e riapplicare l'ultima migrazione per aggiornare i metadati.*</span><span class="sxs-lookup"><span data-stu-id="2a7f0-251">\*\*
*Note:\*\*\*\*This step is required to make it safe to edit the metadata of the migration since the metadata is also stored in the \_\_MigrationsHistoryTable of the database. This is why you should only use this option if the last migration is only in your local code base. If other databases had the last migration applied you would also have to roll them back and re-apply the last migration to update the metadata.*</span></span> 
5.  <span data-ttu-id="2a7f0-252">Eseguire **Add-Migration &lt;completo\_name\_inclusi\_timestamp\_del\_ultima\_migrazione** &gt; (nell'esempio è stato seguito il risultato sarà simile **Add-Migration 201311062215252\_AddReaders**).</span><span class="sxs-lookup"><span data-stu-id="2a7f0-252">Run **Add-Migration &lt;full\_name\_including\_timestamp\_of\_last\_migration**&gt; (in the example we’ve been following this would be something like **Add-Migration 201311062215252\_AddReaders**).</span></span>
    <span data-ttu-id="2a7f0-253">\*\*
    *Nota: \* \* \* è necessario includere il timestamp in modo che le migrazioni sappia che si desidera modificare la migrazione esistente anziché lo scaffolding di una nuova.*</span><span class="sxs-lookup"><span data-stu-id="2a7f0-253">\*\*
    *Note:\*\*\*\*You need to include the timestamp so that migrations knows you want to edit the existing migration rather than scaffolding a new one.*</span></span>
<span data-ttu-id="2a7f0-254">Verranno aggiornati i metadati per l'ultima migrazione in modo che corrisponda al modello corrente.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-254">This will update the metadata for the last migration to match the current model.</span></span> <span data-ttu-id="2a7f0-255">Si otterrà il seguente messaggio di avviso quando il comando viene completato, ma questo è esattamente ciò che si desidera.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-255">You’ll get the following warning when the command completes, but that’s exactly what you want.</span></span> <span data-ttu-id="2a7f0-256">"*Solo il codice di progettazione per la migrazione ' 201311062215252\_AddReaders' è stato nuovamente sottoposto a scaffolding. Per lo scaffolding nuovamente l'intera migrazione, usare il parametro - Force. "*</span><span class="sxs-lookup"><span data-stu-id="2a7f0-256">“*Only the Designer Code for migration '201311062215252\_AddReaders' was re-scaffolded. To re-scaffold the entire migration, use the -Force parameter.”*</span></span>
6.  <span data-ttu-id="2a7f0-257">Eseguire **Update-Database** di riapplicare l'ultima migrazione con i metadati aggiornati.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-257">Run **Update-Database** to re-apply the latest migration with the updated metadata.</span></span>
7.  <span data-ttu-id="2a7f0-258">Continuare a sviluppare o inviare al controllo del codice sorgente (dopo che eseguono gli unit test naturalmente).</span><span class="sxs-lookup"><span data-stu-id="2a7f0-258">Continue developing, or submit to source control (after running your unit tests of course).</span></span>

<span data-ttu-id="2a7f0-259">Ecco lo stato di sviluppatore \#2 locale del codebase dopo aver usato questo approccio.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-259">Here is the state of Developer \#2’s local code base after using this approach.</span></span>

![Aggiornamento dei metadati](~/ef6/media/updatedmetadata.png)

## <a name="summary"></a><span data-ttu-id="2a7f0-261">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="2a7f0-261">Summary</span></span>

<span data-ttu-id="2a7f0-262">Esistono alcuni problemi quando si usa migrazioni Code First in un ambiente di team.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-262">There are some challenges when using Code First Migrations in a team environment.</span></span> <span data-ttu-id="2a7f0-263">Tuttavia, una conoscenza di base del funzionamento delle migrazioni e alcuni approcci semplici per la risoluzione dei conflitti di merge rendono semplice ovviare a questi problemi.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-263">However, a basic understanding of how migrations works and some simple approaches for resolving merge conflicts make it easy to overcome these challenges.</span></span>

<span data-ttu-id="2a7f0-264">Il problema fondamentale è non corretto dei metadati archiviati nel processo di migrazione più recente.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-264">The fundamental issue is incorrect metadata stored in the latest migration.</span></span> <span data-ttu-id="2a7f0-265">In questo modo Code First per rilevare erroneamente che il modello corrente e lo schema del database non corrispondono e per eseguire lo scaffolding di codice non corretto nel processo di migrazione successivo.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-265">This causes Code First to incorrectly detect that the current model and database schema don’t match and to scaffold incorrect code in the next migration.</span></span> <span data-ttu-id="2a7f0-266">Questa situazione possa essere risolti, la generazione di una migrazione vuota con il modello corretto, o aggiornando i metadati nel processo di migrazione più recente.</span><span class="sxs-lookup"><span data-stu-id="2a7f0-266">This situation can be overcome by generating a blank migration with the correct model, or updating the metadata in the latest migration.</span></span>
