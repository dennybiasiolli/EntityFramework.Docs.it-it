---
title: Miglioramento delle prestazioni di avvio con NGen-EF6
author: divega
ms.date: 10/23/2016
ms.assetid: dc6110a0-80a0-4370-8190-cea942841cee
ms.openlocfilehash: 841aec645abdb2a56076d0b70bfb2614b0acafb4
ms.sourcegitcommit: cc0ff36e46e9ed3527638f7208000e8521faef2e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78419461"
---
# <a name="improving-startup-performance-with-ngen"></a><span data-ttu-id="98870-102">Miglioramento delle prestazioni di avvio con NGen</span><span class="sxs-lookup"><span data-stu-id="98870-102">Improving startup performance with NGen</span></span>
> [!NOTE]
> <span data-ttu-id="98870-103">**Solo EF6 e versioni successive**: funzionalità, API e altri argomenti discussi in questa pagina sono stati introdotti in Entity Framework 6.</span><span class="sxs-lookup"><span data-stu-id="98870-103">**EF6 Onwards Only** - The features, APIs, etc. discussed in this page were introduced in Entity Framework 6.</span></span> <span data-ttu-id="98870-104">Se si usa una versione precedente, le informazioni qui riportate, o parte di esse, non sono applicabili.</span><span class="sxs-lookup"><span data-stu-id="98870-104">If you are using an earlier version, some or all of the information does not apply.</span></span>  

<span data-ttu-id="98870-105">Il .NET Framework supporta la generazione di immagini native per le applicazioni e le librerie gestite per aiutare le applicazioni ad avviarsi più velocemente e, in alcuni casi, l'utilizzo di una quantità inferiore di memoria.</span><span class="sxs-lookup"><span data-stu-id="98870-105">The .NET Framework supports the generation of native images for managed applications and libraries as a way to help applications start faster and also in some cases use less memory.</span></span> <span data-ttu-id="98870-106">Le immagini native vengono create convertendo gli assembly di codice gestito in file contenenti istruzioni native della macchina prima dell'esecuzione dell'applicazione, evitando al compilatore .NET JIT (just-in-Time) di generare le istruzioni native in runtime dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="98870-106">Native images are created by translating managed code assemblies into files containing native machine instructions before the application is executed, relieving the .NET JIT (Just-In-Time) compiler from having to generate the native instructions at application runtime.</span></span>  

<span data-ttu-id="98870-107">Prima della versione 6, le librerie principali del runtime EF facevano parte del .NET Framework e le immagini native venivano generate automaticamente.</span><span class="sxs-lookup"><span data-stu-id="98870-107">Prior to version 6, the EF runtime’s core libraries were part of the .NET Framework and native images were generated automatically for them.</span></span> <span data-ttu-id="98870-108">A partire dalla versione 6, l'intero runtime di EF è stato combinato nel pacchetto NuGet EntityFramework.</span><span class="sxs-lookup"><span data-stu-id="98870-108">Starting with version 6 the whole EF runtime has been combined into the EntityFramework NuGet package.</span></span> <span data-ttu-id="98870-109">Le immagini native devono ora essere generate usando lo strumento da riga di comando NGen. exe per ottenere risultati simili.</span><span class="sxs-lookup"><span data-stu-id="98870-109">Native images have to now be generated using the NGen.exe command line tool to obtain similar results.</span></span>  

<span data-ttu-id="98870-110">Le osservazioni empiriche mostrano che le immagini native degli assembly di runtime EF possono tagliare tra 1 e 3 secondi di tempo di avvio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="98870-110">Empirical observations show that native images of the EF runtime assemblies can cut between 1 and 3 seconds of application startup time.</span></span>  

## <a name="how-to-use-ngenexe"></a><span data-ttu-id="98870-111">Come usare NGen. exe</span><span class="sxs-lookup"><span data-stu-id="98870-111">How to use NGen.exe</span></span>  

<span data-ttu-id="98870-112">La funzione più semplice dello strumento NGen. exe consiste nel "installare" (ovvero creare e salvare in modo permanente su disco) immagini native per un assembly e tutte le relative dipendenze dirette.</span><span class="sxs-lookup"><span data-stu-id="98870-112">The most basic function of the NGen.exe tool is to “install” (that is, to create and persist to disk) native images for an assembly and all its direct dependencies.</span></span> <span data-ttu-id="98870-113">Ecco come è possibile ottenere questo risultato:</span><span class="sxs-lookup"><span data-stu-id="98870-113">Here is how you can achieve that:</span></span>  

1. <span data-ttu-id="98870-114">Aprire una finestra del Prompt dei comandi come amministratore.</span><span class="sxs-lookup"><span data-stu-id="98870-114">Open a Command Prompt window as an administrator.</span></span>
2. <span data-ttu-id="98870-115">Impostare la directory di lavoro corrente sul percorso degli assembly per i quali si desidera generare immagini native:</span><span class="sxs-lookup"><span data-stu-id="98870-115">Change the current working directory to the location of the assemblies you want to generate native images for:</span></span>

   ``` console
   cd <*Assemblies location*>  
   ```

3. <span data-ttu-id="98870-116">A seconda del sistema operativo e della configurazione dell'applicazione, potrebbe essere necessario generare immagini native per l'architettura a 32 bit, l'architettura a 64 bit o per entrambe.</span><span class="sxs-lookup"><span data-stu-id="98870-116">Depending on your operating system and the application’s configuration you might need to generate native images for 32 bit architecture, 64 bit architecture or for both.</span></span>

   <span data-ttu-id="98870-117">Per l'esecuzione a 32 bit:</span><span class="sxs-lookup"><span data-stu-id="98870-117">For 32 bit run:</span></span>

   ``` console
   %WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install <Assembly name>  
   ```

   <span data-ttu-id="98870-118">Per l'esecuzione a 64 bit:</span><span class="sxs-lookup"><span data-stu-id="98870-118">For 64 bit run:</span></span>
  
   ``` console
   %WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install <Assembly name>  
   ```

> [!TIP]
> <span data-ttu-id="98870-119">La generazione di immagini native per l'architettura errata è un errore molto comune.</span><span class="sxs-lookup"><span data-stu-id="98870-119">Generating native images for the wrong architecture is a very common mistake.</span></span> <span data-ttu-id="98870-120">In caso di dubbi è possibile generare semplicemente immagini native per tutte le architetture applicabili al sistema operativo installato nel computer.</span><span class="sxs-lookup"><span data-stu-id="98870-120">When in doubt you can simply generate native images for all the architectures that apply to the operating system installed in the machine.</span></span>  

<span data-ttu-id="98870-121">NGen. exe supporta anche altre funzioni, ad esempio la disinstallazione e la visualizzazione delle immagini native installate, l'accodamento della generazione di più immagini e così via. Per ulteriori informazioni sull'utilizzo, vedere la [documentazione di Ngen. exe](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span><span class="sxs-lookup"><span data-stu-id="98870-121">NGen.exe also supports other functions such as uninstalling and displaying the installed native images, queuing the generation of multiple images, etc. For more details of usage read the [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span></span>  

## <a name="when-to-use-ngenexe"></a><span data-ttu-id="98870-122">Quando utilizzare NGen. exe</span><span class="sxs-lookup"><span data-stu-id="98870-122">When to use NGen.exe</span></span>  

<span data-ttu-id="98870-123">Quando si decide quali assembly generare immagini native per in un'applicazione basata su EF versione 6 o successiva, è consigliabile prendere in considerazione le opzioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="98870-123">When it comes to decide which assemblies to generate native images for in an application based on EF version 6 or greater, you should consider the following options:</span></span>  

- <span data-ttu-id="98870-124">**L'assembly di runtime EF principale, EntityFramework. dll**: un'applicazione tipica basata su EF esegue una quantità significativa di codice da questo assembly all'avvio o al primo accesso al database.</span><span class="sxs-lookup"><span data-stu-id="98870-124">**The main EF runtime assembly, EntityFramework.dll**: A typical EF based application executes a significant amount of code from this assembly on startup or on its first access to the database.</span></span> <span data-ttu-id="98870-125">Di conseguenza, la creazione di immagini native di questo assembly produrrà i maggiori vantaggi nelle prestazioni di avvio.</span><span class="sxs-lookup"><span data-stu-id="98870-125">Consequently, creating native images of this assembly will produce the biggest gains in startup performance.</span></span>  
- <span data-ttu-id="98870-126">**Qualsiasi assembly del provider EF usato dall'applicazione: il**tempo di avvio può anche trarre vantaggio leggermente dalla generazione di immagini native.</span><span class="sxs-lookup"><span data-stu-id="98870-126">**Any EF provider assembly used by your application**: Startup time can also benefit slightly from generating native images of these.</span></span> <span data-ttu-id="98870-127">Se, ad esempio, l'applicazione usa il provider EF per SQL Server sarà necessario generare un'immagine nativa per EntityFramework. SqlServer. dll.</span><span class="sxs-lookup"><span data-stu-id="98870-127">For example, if the application uses the EF provider for SQL Server you will want to generate a native image for EntityFramework.SqlServer.dll.</span></span>  
- <span data-ttu-id="98870-128">**Assembly e altre dipendenze dell'applicazione**: la [documentazione di Ngen. exe](https://msdn.microsoft.com/library/6t9t5wcf.aspx) riguarda i criteri generali per la scelta degli assembly per la generazione di immagini native per e l'effetto di immagini native sulla sicurezza, opzioni avanzate, ad esempio "binding hardware", scenari come l'uso di immagini native negli scenari di debug e di profilatura e così via.</span><span class="sxs-lookup"><span data-stu-id="98870-128">**Your application’s assemblies and other dependencies**: The [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx) covers general criteria for choosing which assemblies to generate native images for and the impact of native images on security, advanced options such as “hard binding”, scenarios such as using native images in debugging and profiling scenarios, etc.</span></span>  

> [!TIP]
> <span data-ttu-id="98870-129">Assicurarsi di misurare attentamente l'effetto dell'utilizzo di immagini native sia sulle prestazioni di avvio sia sulle prestazioni complessive dell'applicazione e di confrontarle con i requisiti effettivi.</span><span class="sxs-lookup"><span data-stu-id="98870-129">Make sure you carefully measure the impact of using native images on both the startup performance and the overall performance of your application and compare them against actual requirements.</span></span> <span data-ttu-id="98870-130">Sebbene le immagini native consentano in genere di migliorare le prestazioni di avvio e, in alcuni casi, di ridurre l'utilizzo della memoria, non tutti gli scenari beneficeranno ugualmente.</span><span class="sxs-lookup"><span data-stu-id="98870-130">While native images will generally help improve startup up performance and in some cases reduce memory usage, not all scenarios will benefit equally.</span></span> <span data-ttu-id="98870-131">Ad esempio, in caso di esecuzione di uno stato stabile (ovvero, una volta che tutti i metodi usati dall'applicazione sono stati richiamati almeno una volta), il codice generato dal compilatore JIT può produrre effettivamente prestazioni leggermente migliori rispetto alle immagini native.</span><span class="sxs-lookup"><span data-stu-id="98870-131">For instance, on steady state execution (that is, once all the methods being used by the application have been invoked at least once) code generated by the JIT compiler can in fact yield slightly better performance than native images.</span></span>  

## <a name="using-ngenexe-in-a-development-machine"></a><span data-ttu-id="98870-132">Utilizzo di NGen. exe in un computer di sviluppo</span><span class="sxs-lookup"><span data-stu-id="98870-132">Using NGen.exe in a development machine</span></span>  

<span data-ttu-id="98870-133">Durante lo sviluppo, il compilatore JIT .NET offrirà il migliore compromesso generale per il codice che viene modificato di frequente.</span><span class="sxs-lookup"><span data-stu-id="98870-133">During development the .NET JIT compiler will offer the best overall tradeoff for code that is changing frequently.</span></span> <span data-ttu-id="98870-134">La generazione di immagini native per le dipendenze compilate, ad esempio gli assembly di runtime di EF, consente di accelerare lo sviluppo e il test riducendo alcuni secondi all'inizio di ogni esecuzione.</span><span class="sxs-lookup"><span data-stu-id="98870-134">Generating native images for compiled dependencies such as the EF runtime assemblies can help accelerate development and testing by cutting a few seconds out at the beginning of each execution.</span></span>  

<span data-ttu-id="98870-135">Un posto ideale per trovare gli assembly di runtime EF è il percorso del pacchetto NuGet per la soluzione.</span><span class="sxs-lookup"><span data-stu-id="98870-135">A good place to find the EF runtime assemblies is the NuGet package location for the solution.</span></span> <span data-ttu-id="98870-136">Ad esempio, per un'applicazione che usa EF 6.0.2 con SQL Server e destinata a .NET 4,5 o versione successiva, è possibile digitare quanto segue in una finestra del prompt dei comandi (ricordarsi di aprirla come amministratore):</span><span class="sxs-lookup"><span data-stu-id="98870-136">For example, for an application using EF 6.0.2 with SQL Server and targeting .NET 4.5 or greater you can type the following in a Command Prompt window (remember to open it as an administrator):</span></span>  

```console
cd <Solution directory>\packages\EntityFramework.6.0.2\lib\net45
%WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install EntityFramework.SqlServer.dll
%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install EntityFramework.SqlServer.dll
```  

> [!NOTE]
> <span data-ttu-id="98870-137">Questo sfrutta il fatto che l'installazione delle immagini native per il provider EF per SQL Server installerà anche le immagini native per l'assembly di runtime EF principale.</span><span class="sxs-lookup"><span data-stu-id="98870-137">This takes advantage of the fact that installing the native images for EF provider for SQL Server will also by default install the native images for the main EF runtime assembly.</span></span> <span data-ttu-id="98870-138">Questa operazione funziona perché NGen. exe è in grado di rilevare che EntityFramework. dll è una dipendenza diretta dell'assembly EntityFramework. SqlServer. dll presente nella stessa directory.</span><span class="sxs-lookup"><span data-stu-id="98870-138">This works because NGen.exe can detect that EntityFramework.dll is a direct dependency of the EntityFramework.SqlServer.dll assembly located in the same directory.</span></span>  

## <a name="creating-native-images-during-setup"></a><span data-ttu-id="98870-139">Creazione di immagini native durante l'installazione</span><span class="sxs-lookup"><span data-stu-id="98870-139">Creating native images during setup</span></span>  

<span data-ttu-id="98870-140">Il Toolkit WiX supporta l'accodamento della generazione di immagini native per gli assembly gestiti durante l'installazione, come illustrato in questa [Guida](https://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span><span class="sxs-lookup"><span data-stu-id="98870-140">The WiX Toolkit supports queuing the generation of native images for managed assemblies during setup, as explained in this [how-to guide](https://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span></span> <span data-ttu-id="98870-141">Un'altra alternativa consiste nel creare un'attività di installazione personalizzata che esegua il comando NGen. exe.</span><span class="sxs-lookup"><span data-stu-id="98870-141">Another alternative is to create a custom setup task that execute the NGen.exe command.</span></span>  

## <a name="verifying-that-native-images-are-being-used-for-ef"></a><span data-ttu-id="98870-142">Verifica per verificare se le immagini native vengono usate per EF</span><span class="sxs-lookup"><span data-stu-id="98870-142">Verifying that native images are being used for EF</span></span>  

<span data-ttu-id="98870-143">È possibile verificare che un'applicazione specifica usi un assembly nativo cercando gli assembly caricati con estensione ". ni. dll" o ". ni. exe".</span><span class="sxs-lookup"><span data-stu-id="98870-143">You can verify that a specific application is using a native assembly by looking for loaded assemblies that have the extension “.ni.dll” or “.ni.exe”.</span></span> <span data-ttu-id="98870-144">Ad esempio, un'immagine nativa per l'assembly di runtime principale di EF verrà denominata EntityFramework. ni. dll.</span><span class="sxs-lookup"><span data-stu-id="98870-144">For example, a native image for the EF’s main runtime assembly will be called EntityFramework.ni.dll.</span></span> <span data-ttu-id="98870-145">Un modo semplice per esaminare gli assembly .NET caricati di un processo consiste nell'usare [Esplora processi](https://technet.microsoft.com/sysinternals/bb896653).</span><span class="sxs-lookup"><span data-stu-id="98870-145">An easy way to inspect the loaded .NET assemblies of a process is to use [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653).</span></span>  

## <a name="other-things-to-be-aware-of"></a><span data-ttu-id="98870-146">Altri aspetti da tenere presente</span><span class="sxs-lookup"><span data-stu-id="98870-146">Other things to be aware of</span></span>  

<span data-ttu-id="98870-147">La **creazione di un'immagine nativa di un assembly non deve essere confusa con la registrazione dell'assembly nella [GAC (Global assembly cache)](https://msdn.microsoft.com/library/yf1d93sz.aspx)** .</span><span class="sxs-lookup"><span data-stu-id="98870-147">**Creating a native image of an assembly should not be confused with registering the assembly in the [GAC (Global Assembly Cache)](https://msdn.microsoft.com/library/yf1d93sz.aspx)**.</span></span> <span data-ttu-id="98870-148">NGen. exe consente di creare immagini di assembly che non si trovano nella GAC e, di fatto, più applicazioni che usano una versione specifica di EF possono condividere la stessa immagine nativa.</span><span class="sxs-lookup"><span data-stu-id="98870-148">NGen.exe allows creating images of assemblies that are not in the GAC, and in fact, multiple applications that use a specific version of EF can share the same native image.</span></span> <span data-ttu-id="98870-149">Sebbene Windows 8 sia in grado di creare automaticamente immagini native per gli assembly inseriti nella GAC, il runtime di EF è ottimizzato per essere distribuito insieme all'applicazione e non è consigliabile registrarlo nella GAC, perché questo ha un impatto negativo sulla risoluzione degli assembly e manutenzione delle applicazioni tra gli altri aspetti.</span><span class="sxs-lookup"><span data-stu-id="98870-149">While Windows 8 can automatically create native images for assemblies placed in the GAC, the EF runtime is optimized to be deployed alongside your application and we do not recommend registering it in the GAC as this has a negative impact on assembly resolution and servicing your applications among other aspects.</span></span>  
