---
title: Il modello di provider di Entity Framework 6 - Entity Framework 6
author: divega
ms.date: 2018-06-27
ms.assetid: 066832F0-D51B-4655-8BE7-C983C557E0E4
ms.openlocfilehash: 7d9e2f49b9ef59fb63b024646911ec0d8dfcfc60
ms.sourcegitcommit: 0d36e8ff0892b7f034b765b15e041f375f88579a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/09/2018
ms.locfileid: "44251104"
---
# <a name="the-entity-framework-6-provider-model"></a><span data-ttu-id="372bc-102">Il modello di provider di Entity Framework 6</span><span class="sxs-lookup"><span data-stu-id="372bc-102">The Entity Framework 6 provider model</span></span>

<span data-ttu-id="372bc-103">Il modello di provider di Entity Framework consente a Entity Framework da usare con diversi tipi di server di database.</span><span class="sxs-lookup"><span data-stu-id="372bc-103">The Entity Framework provider model allows Entity Framework to be used with different types of database server.</span></span> <span data-ttu-id="372bc-104">Ad esempio, un provider può essere collegato per consentire all'utilizzo con Microsoft SQL Server, mentre un altro provider può essere inserito nel consentire a Entity Framework da usare con Microsoft SQL Server Compact Edition EF.</span><span class="sxs-lookup"><span data-stu-id="372bc-104">For example, one provider can be plugged in to allow EF to be used against Microsoft SQL Server, while another provider can be plugged into to allow EF to be used against Microsoft SQL Server Compact Edition.</span></span> <span data-ttu-id="372bc-105">I provider per Entity Framework 6 che siamo a conoscenza di sono reperibile nella [provider di Entity Framework](~/ef6/fundamentals/providers/index.md) pagina.</span><span class="sxs-lookup"><span data-stu-id="372bc-105">The providers for EF6 that we are aware of can be found on the [Entity Framework providers](~/ef6/fundamentals/providers/index.md) page.</span></span>

<span data-ttu-id="372bc-106">Determinate modifiche erano necessari al modo in cui che EF interagisce con i provider per consentire a Entity Framework deve essere rilasciato in una licenza open source.</span><span class="sxs-lookup"><span data-stu-id="372bc-106">Certain changes were required to the way EF interacts with providers to allow EF to be released under an open source license.</span></span> <span data-ttu-id="372bc-107">Queste modifiche richiedono la ricompilazione dei provider di Entity Framework per gli assembly di EF6 insieme ai nuovi meccanismi per la registrazione del provider.</span><span class="sxs-lookup"><span data-stu-id="372bc-107">These changes require rebuilding of EF providers against the EF6 assemblies together with new mechanisms for registration of the provider.</span></span>

## <a name="rebuilding"></a><span data-ttu-id="372bc-108">La ricompilazione</span><span class="sxs-lookup"><span data-stu-id="372bc-108">Rebuilding</span></span>

<span data-ttu-id="372bc-109">Con Entity Framework 6 ora viene fornito il codice di base che precedentemente faceva parte di .NET Framework come assembly di fuori banda (OOB).</span><span class="sxs-lookup"><span data-stu-id="372bc-109">With EF6 the core code that was previously part of the .NET Framework is now being shipped as out-of-band (OOB) assemblies.</span></span> <span data-ttu-id="372bc-110">Informazioni dettagliate su come creare applicazioni rispetto a EF6 sono reperibile nella [l'aggiornamento di applicazioni per EF6](~/ef6/what-is-new/upgrading-to-ef6.md) pagina.</span><span class="sxs-lookup"><span data-stu-id="372bc-110">Details on how to build applications against EF6 can be found on the [Updating applications for EF6](~/ef6/what-is-new/upgrading-to-ef6.md) page.</span></span> <span data-ttu-id="372bc-111">I provider verranno anche devono essere ricompilati usando le istruzioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="372bc-111">Providers will also need to be rebuilt using these instructions.</span></span>

## <a name="provider-types-overview"></a><span data-ttu-id="372bc-112">Panoramica dei tipi di provider</span><span class="sxs-lookup"><span data-stu-id="372bc-112">Provider types overview</span></span>

<span data-ttu-id="372bc-113">Un provider di Entity Framework è davvero una raccolta di servizi specifici del provider definito da tipi CLR che questi servizi estendono da (per una classe di base) o implementano (per un'interfaccia).</span><span class="sxs-lookup"><span data-stu-id="372bc-113">An EF provider is really a collection of provider-specific services defined by CLR types that these services extend from (for a base class) or implement (for an interface).</span></span> <span data-ttu-id="372bc-114">Due di questi servizi sono fondamentali e necessaria per funzionare correttamente a Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="372bc-114">Two of these services are fundamental and necessary for EF to function at all.</span></span> <span data-ttu-id="372bc-115">Gli altri sono facoltativi e devono solo essere implementati se è necessaria la funzionalità specifiche e/o le implementazioni predefinite di questi servizi non funziona per il server di database specifici vengano specificate come destinazione.</span><span class="sxs-lookup"><span data-stu-id="372bc-115">Others are optional and only need to be implemented if specific functionality is required and/or the default implementations of these services does not work for the specific database server being targeted.</span></span>

## <a name="fundamental-provider-types"></a><span data-ttu-id="372bc-116">Tipi fondamentali provider</span><span class="sxs-lookup"><span data-stu-id="372bc-116">Fundamental provider types</span></span>

### <a name="dbproviderfactory"></a><span data-ttu-id="372bc-117">Classe DbProviderFactory</span><span class="sxs-lookup"><span data-stu-id="372bc-117">DbProviderFactory</span></span>

<span data-ttu-id="372bc-118">Entity Framework dipende dalla presenza di un tipo derivato da [DbProviderFactory](http://msdn.microsoft.com/en-us/library/system.data.common.dbproviderfactory.aspx) per l'esecuzione di tutti gli accessi di basso livello di database.</span><span class="sxs-lookup"><span data-stu-id="372bc-118">EF depends on having a type derived from [System.Data.Common.DbProviderFactory](http://msdn.microsoft.com/en-us/library/system.data.common.dbproviderfactory.aspx) for performing all low-level database access.</span></span> <span data-ttu-id="372bc-119">DbProviderFactory non è in realtà parte di Entity Framework, ma è invece una classe in .NET Framework che fornisce un punto di ingresso per i provider ADO.NET che può essere usata da Entity Framework, altri O/RMs o direttamente da un'applicazione per ottenere le istanze di connessioni, comandi, parametri e altre astrazioni di ADO.NET in un provider indipendente dalla modalità.</span><span class="sxs-lookup"><span data-stu-id="372bc-119">DbProviderFactory is not actually part of EF but is instead a class in the .NET Framework that serves an entry point for ADO.NET providers that can be used by EF, other O/RMs or directly by an application to obtain instances of connections, commands, parameters and other ADO.NET abstractions in a provider agnostic way.</span></span> <span data-ttu-id="372bc-120">Altre informazioni sulla classe DbProviderFactory un reperibile nella [documentazione di MSDN per ADO.NET](http://msdn.microsoft.com/en-us/library/a6cd7c08.aspx).</span><span class="sxs-lookup"><span data-stu-id="372bc-120">More information about DbProviderFactory an be found in the [MSDN documentation for ADO.NET](http://msdn.microsoft.com/en-us/library/a6cd7c08.aspx).</span></span>

### <a name="dbproviderservices"></a><span data-ttu-id="372bc-121">DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="372bc-121">DbProviderServices</span></span>

<span data-ttu-id="372bc-122">Entity Framework dipende dalla presenza di un tipo derivato da DbProviderServices per fornire funzionalità aggiuntive necessarie da Entity Framework sopra la funzionalità già fornita dal provider ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="372bc-122">EF depends on having a type derived from DbProviderServices for providing additional functionality needed by EF on top of the functionality already provided by the ADO.NET provider.</span></span> <span data-ttu-id="372bc-123">Nelle versioni precedenti di Entity Framework la classe DbProviderServices faceva parte di .NET Framework e in spazio dei nomi è stata trovata.</span><span class="sxs-lookup"><span data-stu-id="372bc-123">In older versions of EF the DbProviderServices class was part of the .NET Framework and was found in the System.Data.Common namespace.</span></span> <span data-ttu-id="372bc-124">Avvio con Entity Framework 6 di questa classe fa ora parte del file EntityFramework. dll e sia nello spazio dei nomi System.Data.Entity.Core.Common.</span><span class="sxs-lookup"><span data-stu-id="372bc-124">Starting with EF6 this class is now part of EntityFramework.dll and is in the System.Data.Entity.Core.Common namespace.</span></span>

<span data-ttu-id="372bc-125">Altre informazioni sulle funzionalità fondamentali di un'implementazione di DbProviderServices sono reperibile nella [MSDN](http://msdn.microsoft.com/en-us/library/ee789835.aspx).</span><span class="sxs-lookup"><span data-stu-id="372bc-125">More details about the fundamental functionality of a DbProviderServices implementation can be found on [MSDN](http://msdn.microsoft.com/en-us/library/ee789835.aspx).</span></span> <span data-ttu-id="372bc-126">Tuttavia, si noti che al momento della scrittura di queste informazioni non viene aggiornato per EF6 Sebbene la maggior parte dei concetti sono ancora valida.</span><span class="sxs-lookup"><span data-stu-id="372bc-126">However, note that as of the time of writing this information is not updated for EF6 although most of the concepts are still valid.</span></span> <span data-ttu-id="372bc-127">Le implementazioni di SQL Server e SQL Server Compact di DbProviderServices vengono controllate anche in per il [open source codebase](https://github.com/aspnet/EntityFramework6/) e può essere usato come riferimento utile per le altre implementazioni.</span><span class="sxs-lookup"><span data-stu-id="372bc-127">The SQL Server and SQL Server Compact implementations of DbProviderServices are also checked into to the [open-source codebase](https://github.com/aspnet/EntityFramework6/) and can serve as useful references for other implementations.</span></span>

<span data-ttu-id="372bc-128">Nelle versioni precedenti di Entity Framework è stato ottenuto l'implementazione di DbProviderServices per utilizzare direttamente da un provider ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="372bc-128">In older versions of EF the DbProviderServices implementation to use was obtained directly from an ADO.NET provider.</span></span> <span data-ttu-id="372bc-129">Tale operazione viene eseguita eseguendo il cast DbProviderFactory a IServiceProvider e chiamare il metodo GetService.</span><span class="sxs-lookup"><span data-stu-id="372bc-129">This was done by casting DbProviderFactory to IServiceProvider and calling the GetService method.</span></span> <span data-ttu-id="372bc-130">Ciò strettamente il provider di Entity Framework per l'elemento DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="372bc-130">This tightly coupled the EF provider to the DbProviderFactory.</span></span> <span data-ttu-id="372bc-131">Questo accoppiamento bloccato EF venga spostato all'esterno di .NET Framework e pertanto per Entity Framework 6 è stato rimosso l'accoppiamento stretto e un'implementazione di DbProviderServices è ora registrata direttamente nel file di configurazione dell'applicazione o in basata su codice configurazione, come descritto più dettagliatamente la _DbProviderServices registrazione_ sezione riportata di seguito.</span><span class="sxs-lookup"><span data-stu-id="372bc-131">This coupling blocked EF from being moved out of the .NET Framework and therefore for EF6 this tight coupling has been removed and an implementation of DbProviderServices is now registered directly in the application’s configuration file or in code-based configuration as described in more detail the _Registering DbProviderServices_ section below.</span></span>

## <a name="additional-services"></a><span data-ttu-id="372bc-132">Servizi aggiuntivi</span><span class="sxs-lookup"><span data-stu-id="372bc-132">Additional services</span></span>

<span data-ttu-id="372bc-133">Oltre ai servizi fondamentali descritti in precedenza esistono anche molti altri servizi usati da Entity Framework che sono specifiche del provider sempre o talvolta.</span><span class="sxs-lookup"><span data-stu-id="372bc-133">In addition to the fundamental services described above there are also many other services used by EF which are either always or sometimes provider-specific.</span></span> <span data-ttu-id="372bc-134">Le implementazioni specifiche del provider predefinito di questi servizi possono essere fornite da un'implementazione di DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="372bc-134">Default provider-specific implementations of these services can be supplied by a DbProviderServices implementation.</span></span> <span data-ttu-id="372bc-135">Le applicazioni possono anche sostituire le implementazioni di questi servizi, o fornire implementazioni quando un tipo di DbProviderServices non fornisce un valore predefinito.</span><span class="sxs-lookup"><span data-stu-id="372bc-135">Applications can also override the implementations of these services, or provide implementations when a DbProviderServices type does not provide a default.</span></span> <span data-ttu-id="372bc-136">Come descritto più dettagliatamente il _risoluzione di altri servizi_ sezione riportata di seguito.</span><span class="sxs-lookup"><span data-stu-id="372bc-136">This is described in more detail in the _Resolving additional services_ section below.</span></span>

<span data-ttu-id="372bc-137">I tipi di servizio aggiuntiva che un provider può essere di interesse a un provider sono elencati di seguito.</span><span class="sxs-lookup"><span data-stu-id="372bc-137">The additional service types that a provider may be of interest to a provider are listed below.</span></span> <span data-ttu-id="372bc-138">Informazioni dettagliate su ognuno di questi tipi di servizio sono reperibile nella documentazione dell'API.</span><span class="sxs-lookup"><span data-stu-id="372bc-138">More details about each of these service types can be found in the API documentation.</span></span>

### <a name="idbexecutionstrategy"></a><span data-ttu-id="372bc-139">IDbExecutionStrategy</span><span class="sxs-lookup"><span data-stu-id="372bc-139">IDbExecutionStrategy</span></span>

<span data-ttu-id="372bc-140">Si tratta di un servizio facoltativo che consente a un provider implementare nuovi tentativi o altri comportamenti quando vengono eseguiti query e comandi sul database.</span><span class="sxs-lookup"><span data-stu-id="372bc-140">This is an optional service that allows a provider to implement retries or other behavior when queries and commands are executed against the database.</span></span> <span data-ttu-id="372bc-141">Se non viene fornita alcuna implementazione, quindi EF verranno semplicemente eseguire i comandi e propaga le eccezioni generate.</span><span class="sxs-lookup"><span data-stu-id="372bc-141">If no implementation is provided, then EF will simply execute the commands and propagate any exceptions thrown.</span></span> <span data-ttu-id="372bc-142">Per SQL Server questo servizio viene utilizzato per fornire un criterio di ripetizione dei tentativi che risulta particolarmente utile durante l'esecuzione per i server di database basato sul cloud, ad esempio SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="372bc-142">For SQL Server this service is used to provide a retry policy which is especially useful when running against cloud-based database servers such as SQL Azure.</span></span>

### <a name="idbconnectionfactory"></a><span data-ttu-id="372bc-143">IDbConnectionFactory</span><span class="sxs-lookup"><span data-stu-id="372bc-143">IDbConnectionFactory</span></span>

<span data-ttu-id="372bc-144">Si tratta di un servizio facoltativo che consente a un provider creare oggetti DbConnection per convenzione quando viene fornito solo un nome di database.</span><span class="sxs-lookup"><span data-stu-id="372bc-144">This is an optional service that allows a provider to create DbConnection objects by convention when given only a database name.</span></span> <span data-ttu-id="372bc-145">Si noti che anche se questo servizio può essere risolto da un'implementazione di DbProviderServices fin Entity Framework 4.1 e può anche essere impostata esplicitamente nel file config o nel codice.</span><span class="sxs-lookup"><span data-stu-id="372bc-145">Note that while this service can be resolved by a DbProviderServices implementation it has been present since EF 4.1 and can also be explicitly set in either the config file or in code.</span></span> <span data-ttu-id="372bc-146">Il provider recupera solo possibilità di risolvere il servizio se registrato come provider predefinito (vedere _il provider predefinito_ sotto) e, se non è stata impostata una factory di connessione predefinito in un' posizione.</span><span class="sxs-lookup"><span data-stu-id="372bc-146">The provider will only get a chance to resolve this service if it registered as the default provider (see _The default provider_ below) and if a default connection factory has not been set elsewhere.</span></span>

### <a name="dbspatialservices"></a><span data-ttu-id="372bc-147">DbSpatialServices</span><span class="sxs-lookup"><span data-stu-id="372bc-147">DbSpatialServices</span></span>

<span data-ttu-id="372bc-148">Si tratta di un servizi facoltativi che consente a un provider aggiungere il supporto per i tipi spaziali di geografia e geometria.</span><span class="sxs-lookup"><span data-stu-id="372bc-148">This is an optional services that allows a provider to add support for geography and geometry spatial types.</span></span> <span data-ttu-id="372bc-149">Affinché un'applicazione per l'uso di Entity Framework con i tipi spaziali, è necessario specificare un'implementazione di questo servizio.</span><span class="sxs-lookup"><span data-stu-id="372bc-149">An implementation of this service must be supplied in order for an application to use EF with spatial types.</span></span> <span data-ttu-id="372bc-150">DbSptialServices viene chiesta in due modi.</span><span class="sxs-lookup"><span data-stu-id="372bc-150">DbSptialServices is asked for in two ways.</span></span> <span data-ttu-id="372bc-151">In primo luogo, specifico del provider servizi spaziali vengono richiesti utilizzando un oggetto DbProviderInfo (che contiene invariante token del manifesto e nome) come chiave.</span><span class="sxs-lookup"><span data-stu-id="372bc-151">First, provider-specific spatial services are requested using a DbProviderInfo object (which contains invariant name and manifest token) as key.</span></span> <span data-ttu-id="372bc-152">In secondo luogo, è possibile chiedere DbSpatialServices per senza chiave.</span><span class="sxs-lookup"><span data-stu-id="372bc-152">Second, DbSpatialServices can be asked for with no key.</span></span> <span data-ttu-id="372bc-153">Ciò consente di risolvere il "globale spaziale provider" che viene usato quando si creano tipi di DbGeography o DbGeometry autonomi.</span><span class="sxs-lookup"><span data-stu-id="372bc-153">This is used to resolve the “global spatial provider” that is used when creating stand-alone DbGeography or DbGeometry types.</span></span>

### <a name="migrationsqlgenerator"></a><span data-ttu-id="372bc-154">MigrationSqlGenerator</span><span class="sxs-lookup"><span data-stu-id="372bc-154">MigrationSqlGenerator</span></span>

<span data-ttu-id="372bc-155">Si tratta di un servizio facoltativo che consente migrazioni di Entity Framework da utilizzare per la generazione di SQL utilizzato per la creazione e modifica di schemi di database da Code First.</span><span class="sxs-lookup"><span data-stu-id="372bc-155">This is an optional service that allows EF Migrations to be used for the generation of SQL used in creating and modifying database schemas by Code First.</span></span> <span data-ttu-id="372bc-156">Un'implementazione è necessaria per supportare le migrazioni.</span><span class="sxs-lookup"><span data-stu-id="372bc-156">An implementation is required in order to support Migrations.</span></span> <span data-ttu-id="372bc-157">Se viene fornita un'implementazione quindi verrà inoltre utilizzato quando i database vengono creati usando gli inizializzatori di database o il metodo Database.Create.</span><span class="sxs-lookup"><span data-stu-id="372bc-157">If an implementation is provided then it will also be used when databases are created using database initializers or the Database.Create method.</span></span>

### <a name="funcdbconnection-string-historycontextfactory"></a><span data-ttu-id="372bc-158">Func < DbConnection, stringa, HistoryContextFactory ></span><span class="sxs-lookup"><span data-stu-id="372bc-158">Func<DbConnection, string, HistoryContextFactory></span></span>

<span data-ttu-id="372bc-159">Si tratta di un servizio facoltativo che consente a un provider configurare il mapping del HistoryContext al `__MigrationHistory` tabella utilizzata dal migrazioni di Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="372bc-159">This is an optional service that allows a provider to configure the mapping of the HistoryContext to the `__MigrationHistory` table used by EF Migrations.</span></span> <span data-ttu-id="372bc-160">Il HistoryContext è un primo oggetto DbContext di codice e può essere configurato usando l'API fluent normale per modificare elementi come il nome della tabella e le specifiche di mapping di colonna.</span><span class="sxs-lookup"><span data-stu-id="372bc-160">The HistoryContext is a Code First DbContext and can be configured using the normal fluent API to change things like the name of the table and the column mapping specifications.</span></span> <span data-ttu-id="372bc-161">L'implementazione predefinita di questo servizio restituito da Entity Framework per tutti i provider potrebbe funzionare per un server di database specificata se tutte le tabelle e colonne mapping predefiniti sono supportati da tale provider.</span><span class="sxs-lookup"><span data-stu-id="372bc-161">The default implementation of this service returned by EF for all providers may work for a given database server if all the default table and column mappings are supported by that provider.</span></span> <span data-ttu-id="372bc-162">In tal caso il provider non è necessario fornire un'implementazione di questo servizio.</span><span class="sxs-lookup"><span data-stu-id="372bc-162">In such a case the provider does not need to supply an implementation of this service.</span></span>

### <a name="idbproviderfactoryresolver"></a><span data-ttu-id="372bc-163">IDbProviderFactoryResolver</span><span class="sxs-lookup"><span data-stu-id="372bc-163">IDbProviderFactoryResolver</span></span>

<span data-ttu-id="372bc-164">Si tratta di un servizio facoltativo per l'acquisizione di DbProviderFactory corretto da un oggetto DbConnection specificato.</span><span class="sxs-lookup"><span data-stu-id="372bc-164">This is an optional service for obtaining the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="372bc-165">L'implementazione predefinita di questo servizio restituito da Entity Framework per tutti i provider deve funzionare per tutti i provider.</span><span class="sxs-lookup"><span data-stu-id="372bc-165">The default implementation of this service returned by EF for all providers is intended to work for all providers.</span></span> <span data-ttu-id="372bc-166">Tuttavia, durante l'esecuzione in .NET 4, l'elemento DbProviderFactory non accessibile pubblicamente da uno se relativo DbConnections.</span><span class="sxs-lookup"><span data-stu-id="372bc-166">However, when running on .NET 4, the DbProviderFactory is not publicly accessible from one if its DbConnections.</span></span> <span data-ttu-id="372bc-167">Pertanto, Entity Framework Usa alcune regole euristiche per ricercare i provider registrati per trovare una corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="372bc-167">Therefore, EF uses some heuristics to search the registered providers to find a match.</span></span> <span data-ttu-id="372bc-168">È possibile che per alcuni provider di questi sistemi euristici avrà esito negativo e in questi casi il provider deve fornire una nuova implementazione.</span><span class="sxs-lookup"><span data-stu-id="372bc-168">It is possible that for some providers these heuristics will fail and in such situations the provider should supply a new implementation.</span></span>

## <a name="registering-dbproviderservices"></a><span data-ttu-id="372bc-169">La registrazione di DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="372bc-169">Registering DbProviderServices</span></span>

<span data-ttu-id="372bc-170">È possibile registrare l'implementazione di DbProviderServices da utilizzare nel file di configurazione (app. config o Web. config) o utilizzando la configurazione basata su codice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="372bc-170">The DbProviderServices implementation to use can be registered either in the application’s configuration file (app.config or web.config) or using code-based configuration.</span></span> <span data-ttu-id="372bc-171">In entrambi i casi la registrazione viene utilizzato il nome del provider"inglese" come chiave.</span><span class="sxs-lookup"><span data-stu-id="372bc-171">In either case the registration uses the provider’s “invariant name” as a key.</span></span> <span data-ttu-id="372bc-172">In questo modo più provider registrati e l'uso in una singola applicazione.</span><span class="sxs-lookup"><span data-stu-id="372bc-172">This allows multiple providers to be registered and used in a single application.</span></span> <span data-ttu-id="372bc-173">Il nome invariante usato per le registrazioni di Entity Framework è lo stesso come il nome invariante usato per le stringhe di connessione e la registrazione del provider ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="372bc-173">The invariant name used for EF registrations is the same as the invariant name used for ADO.NET provider registration and connection strings.</span></span> <span data-ttu-id="372bc-174">Ad esempio, per SQL Server, il nome invariante viene usato "SqlClient".</span><span class="sxs-lookup"><span data-stu-id="372bc-174">For example, for SQL Server the invariant name “System.Data.SqlClient” is used.</span></span>

### <a name="config-file-registration"></a><span data-ttu-id="372bc-175">Registrazione nel file di configurazione</span><span class="sxs-lookup"><span data-stu-id="372bc-175">Config file registration</span></span>

<span data-ttu-id="372bc-176">Il tipo di DbProviderServices da utilizzare viene registrato come un elemento provider nell'elenco di provider della sezione entityFramework del file di configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="372bc-176">The DbProviderServices type to use is registered as a provider element in the providers list of the entityFramework section of the application’s config file.</span></span> <span data-ttu-id="372bc-177">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="372bc-177">For example:</span></span>

``` xml
<entityFramework>
  <providers>
    <provider invariantName="My.Invariant.Name" type="MyProvider.MyProviderServices, MyAssembly" />
  </providers>
</entityFramework>
```

<span data-ttu-id="372bc-178">Il _tipo_ stringa deve essere il nome del tipo qualificato dall'assembly di implementazione di DbProviderServices da utilizzare.</span><span class="sxs-lookup"><span data-stu-id="372bc-178">The _type_ string must be the assembly-qualified type name of the DbProviderServices implementation to use.</span></span>

### <a name="code-based-registration"></a><span data-ttu-id="372bc-179">Registrazione basata su codice</span><span class="sxs-lookup"><span data-stu-id="372bc-179">Code-based registration</span></span>

<span data-ttu-id="372bc-180">A partire da Entity Framework 6 provider possono essere registrati usando il codice.</span><span class="sxs-lookup"><span data-stu-id="372bc-180">Starting with EF6 providers can also be registered using code.</span></span> <span data-ttu-id="372bc-181">In questo modo un provider di Entity Framework da usare senza apportare modifiche al file di configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="372bc-181">This allows an EF provider to be used without any change to the application’s configuration file.</span></span> <span data-ttu-id="372bc-182">Per utilizzare la configurazione basata su codice un'applicazione deve creare una classe DbConfiguration come descritto nel [documentazione relativa alla configurazione basata su codice](http://msdn.com/data/jj680699).</span><span class="sxs-lookup"><span data-stu-id="372bc-182">To use code-based configuration an application should create a DbConfiguration class as described in the [code-based configuration documentation](http://msdn.com/data/jj680699).</span></span> <span data-ttu-id="372bc-183">Il costruttore della classe DbConfiguration deve quindi chiamare SetProviderServices per registrare il provider di Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="372bc-183">The constructor of the DbConfiguration class should then call SetProviderServices to register the EF provider.</span></span> <span data-ttu-id="372bc-184">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="372bc-184">For example:</span></span>

``` csharp
public class MyConfiguration : DbConfiguration
{
    public MyConfiguration()
    {
        SetProviderServices("My.New.Provider", new MyProviderServices());
    }
}
```

## <a name="resolving-additional-services"></a><span data-ttu-id="372bc-185">La risoluzione dei servizi aggiuntivi</span><span class="sxs-lookup"><span data-stu-id="372bc-185">Resolving additional services</span></span>

<span data-ttu-id="372bc-186">Come indicato in precedenza nel _Panoramica di Provider di tipi_ sezione DbProviderServices una classe può essere utilizzata anche per risolvere i servizi aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="372bc-186">As mentioned above in the _Provider types overview_ section, a DbProviderServices class can also be used to resolve additional services.</span></span> <span data-ttu-id="372bc-187">Questo è possibile perché DbProviderServices implementa IDbDependencyResolver e ogni tipo di DbProviderServices registrato viene aggiunto come un resolver"predefinito".</span><span class="sxs-lookup"><span data-stu-id="372bc-187">This is possible because DbProviderServices implements IDbDependencyResolver and each registered DbProviderServices type is added as a “default resolver”.</span></span> <span data-ttu-id="372bc-188">Il meccanismo di IDbDpendencyResolver è descritto più dettagliatamente [risoluzione delle dipendenze](~/ef6/fundamentals/configuring/dependency-resolution.md).</span><span class="sxs-lookup"><span data-stu-id="372bc-188">The IDbDpendencyResolver mechanism is described in more detail in [Dependency Resolution](~/ef6/fundamentals/configuring/dependency-resolution.md).</span></span> <span data-ttu-id="372bc-189">Non è tuttavia necessario comprendere tutti i concetti presentati in questa specifica per risolvere i servizi aggiuntivi in un provider.</span><span class="sxs-lookup"><span data-stu-id="372bc-189">However, it is not necessary to understand all the concepts in this specification to resolve additional services in a provider.</span></span>

<span data-ttu-id="372bc-190">Il modo più comune per un provider risolvere i servizi aggiuntivi consiste nel chiamare DbProviderServices.AddDependencyResolver per ogni servizio nel costruttore della classe DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="372bc-190">The most common way for a provider to resolve additional services is to call DbProviderServices.AddDependencyResolver for each service in the constructor of the DbProviderServices class.</span></span> <span data-ttu-id="372bc-191">Ad esempio, SqlProviderServices (provider di Entity Framework per SQL Server) con codice simile al seguente per l'inizializzazione:</span><span class="sxs-lookup"><span data-stu-id="372bc-191">For example, SqlProviderServices (the EF provider for SQL Server) has code similar to this for initialization:</span></span>

``` csharp
private SqlProviderServices()
{
    AddDependencyResolver(new SingletonDependencyResolver<IDbConnectionFactory>(
        new SqlConnectionFactory()));

    AddDependencyResolver(new ExecutionStrategyResolver<DefaultSqlExecutionStrategy>(
        "System.data.SqlClient", null, () => new DefaultSqlExecutionStrategy()));

    AddDependencyResolver(new SingletonDependencyResolver<Func<MigrationSqlGenerator>>(
        () => new SqlServerMigrationSqlGenerator(), "System.data.SqlClient"));

    AddDependencyResolver(new SingletonDependencyResolver<DbSpatialServices>(
        SqlSpatialServices.Instance,
        k =>
        {
            var asSpatialKey = k as DbProviderInfo;
            return asSpatialKey == null
                || asSpatialKey.ProviderInvariantName == ProviderInvariantName;
        }));
}
```

<span data-ttu-id="372bc-192">Questo costruttore utilizza le classi helper seguenti:</span><span class="sxs-lookup"><span data-stu-id="372bc-192">This constructor uses the following helper classes:</span></span>

*   <span data-ttu-id="372bc-193">SingletonDependencyResolver: fornisce un modo semplice per risolvere i servizi Singleton, vale a dire, i servizi per cui la stessa istanza viene restituita ogni volta che viene chiamato GetService.</span><span class="sxs-lookup"><span data-stu-id="372bc-193">SingletonDependencyResolver: provides a simple way to resolve Singleton services—that is, services for which the same instance is returned each time that GetService is called.</span></span> <span data-ttu-id="372bc-194">Servizi temporanei spesso vengono registrati come una factory di singleton che verrà utilizzata per creare istanze temporanee su richiesta.</span><span class="sxs-lookup"><span data-stu-id="372bc-194">Transient services are often registered as a singleton factory that will be used to create transient instances on demand.</span></span>
*   <span data-ttu-id="372bc-195">ExecutionStrategyResolver: un sistema di risoluzione specifico per la restituzione IExecutionStrategy implementazioni.</span><span class="sxs-lookup"><span data-stu-id="372bc-195">ExecutionStrategyResolver: a resolver specific to returning IExecutionStrategy implementations.</span></span>

<span data-ttu-id="372bc-196">Invece di usare DbProviderServices.AddDependencyResolver è anche possibile eseguire l'override DbProviderServices.GetService e risolvere i servizi aggiuntivi direttamente.</span><span class="sxs-lookup"><span data-stu-id="372bc-196">Instead of using DbProviderServices.AddDependencyResolver it is also possible to override DbProviderServices.GetService and resolve additional services directly.</span></span> <span data-ttu-id="372bc-197">Questo metodo verrà chiamato quando Entity Framework necessita di un servizio definito da un determinato tipo e, in alcuni casi, per una determinata chiave.</span><span class="sxs-lookup"><span data-stu-id="372bc-197">This method will be called when EF needs a service defined by a certain type and, in some cases, for a given key.</span></span> <span data-ttu-id="372bc-198">Il metodo deve restituire il servizio, se possibile, o restituisce null per rifiutare esplicitamente la restituzione del servizio e consentire invece un'altra classe risolvere il problema.</span><span class="sxs-lookup"><span data-stu-id="372bc-198">The method should return the service if it can, or return null to opt-out of returning the service and instead allow another class to resolve it.</span></span> <span data-ttu-id="372bc-199">Ad esempio, per risolvere la factory di connessione predefinita il codice nel metodo GetService potrebbe essere un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="372bc-199">For example, to resolve the default connection factory the code in GetService might look something like this:</span></span>

``` csharp
public override object GetService(Type type, object key)
{
    if (type == typeof(IDbConnectionFactory))
    {
        return new SqlConnectionFactory();
    }
    return null;
}
```

### <a name="registration-order"></a><span data-ttu-id="372bc-200">Ordine di registrazione</span><span class="sxs-lookup"><span data-stu-id="372bc-200">Registration order</span></span>

<span data-ttu-id="372bc-201">Quando più implementazioni di DbProviderServices vengono registrate nel file di configurazione dell'applicazione verranno aggiunti come resolver secondario nell'ordine in cui sono elencati.</span><span class="sxs-lookup"><span data-stu-id="372bc-201">When multiple DbProviderServices implementations are registered in an application’s config file they will be added as secondary resolvers in the order that they are listed.</span></span> <span data-ttu-id="372bc-202">Poiché i resolver vengono aggiunti sempre nella parte superiore della catena di resolver secondario che ciò significa che il provider alla fine dell'elenco otterranno possibilità di risolvere le dipendenze prima delle altre.</span><span class="sxs-lookup"><span data-stu-id="372bc-202">Since resolvers are always added to the top of the secondary resolver chain this means that the provider at the end of the list will get a chance to resolve dependencies before the others.</span></span> <span data-ttu-id="372bc-203">(Ciò può sembrare poco plausibili inizialmente, ma ha senso se si immagina prendendo ogni provider dall'elenco e lo stacking sopra i provider esistenti).</span><span class="sxs-lookup"><span data-stu-id="372bc-203">(This can seem a little counter-intuitive at first, but it makes sense if you imagine taking each provider out of the list and stacking it on top of the existing providers.)</span></span>

<span data-ttu-id="372bc-204">Questo ordinamento in genere non è importante perché la maggior parte dei servizi del provider sono specifiche del provider e con chiave dal nome invariante del provider.</span><span class="sxs-lookup"><span data-stu-id="372bc-204">This ordering usually doesn’t matter because most provider services are provider-specific and keyed by provider invariant name.</span></span> <span data-ttu-id="372bc-205">Tuttavia, per i servizi che non sono ordinate per nome invariante del provider o alcuni altri specifico del provider key che verrà risolto al servizio basato su tale ordinamento.</span><span class="sxs-lookup"><span data-stu-id="372bc-205">However, for services that are not keyed by provider invariant name or some other provider-specific key the service will be resolved based on this ordering.</span></span> <span data-ttu-id="372bc-206">Ad esempio, se non è esplicitamente impostata in modo diverso in un punto qualsiasi caso contrario, la factory di connessione predefinita verrà provenire dal provider di livello più alto nella catena.</span><span class="sxs-lookup"><span data-stu-id="372bc-206">For example, if it is not explicitly set differently somewhere else, then the default connection factory will come from the topmost provider in the chain.</span></span>

## <a name="additional-config-file-registrations"></a><span data-ttu-id="372bc-207">Registrazioni dei file di configurazione aggiuntivi</span><span class="sxs-lookup"><span data-stu-id="372bc-207">Additional config file registrations</span></span>

<span data-ttu-id="372bc-208">È possibile registrare in modo esplicito alcuni dei servizi di provider aggiuntivo descritti in precedenza direttamente nel file di configurazione di un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="372bc-208">It is possible to explicitly register some of the additional provider services described above directly in an application’s config file.</span></span> <span data-ttu-id="372bc-209">Quando questa operazione viene eseguita la registrazione nel file di configurazione verrà utilizzata invece di un valore restituito dal metodo GetService dell'implementazione di DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="372bc-209">When this is done the registration in the config file will be used instead of anything returned by the GetService method of the DbProviderServices implementation.</span></span>

### <a name="registering-the-default-connection-factory"></a><span data-ttu-id="372bc-210">Registrazione della factory di connessione predefinito</span><span class="sxs-lookup"><span data-stu-id="372bc-210">Registering the default connection factory</span></span>

<span data-ttu-id="372bc-211">Avvio con EF5 del pacchetto EntityFramework NuGet automaticamente registrata la factory di connessione SQL Express o factory di connessione LocalDb nel file di configurazione.</span><span class="sxs-lookup"><span data-stu-id="372bc-211">Starting with EF5 the EntityFramework NuGet package automatically registered either the SQL Express connection factory or the LocalDb connection factory in the config file.</span></span>

<span data-ttu-id="372bc-212">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="372bc-212">For example:</span></span>

``` xml
<entityFramework>
  <defaultConnectionFactory type="System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework" >
</entityFramework>
```

<span data-ttu-id="372bc-213">Il _tipo_ è il nome del tipo qualificato dall'assembly per la factory di connessione predefinito, che deve implementare IDbConnectionFactory.</span><span class="sxs-lookup"><span data-stu-id="372bc-213">The _type_ is the assembly-qualified type name for the default connection factory, which must implement IDbConnectionFactory.</span></span>

<span data-ttu-id="372bc-214">È consigliabile che un pacchetto NuGet del provider impostato la factory di connessione predefinito in questo modo durante l'installazione.</span><span class="sxs-lookup"><span data-stu-id="372bc-214">It is recommended that a provider NuGet package set the default connection factory in this way when installed.</span></span> <span data-ttu-id="372bc-215">Visualizzare _i pacchetti NuGet per i provider_ sotto.</span><span class="sxs-lookup"><span data-stu-id="372bc-215">See _NuGet Packages for providers_ below.</span></span>

## <a name="additional-ef6-provider-changes"></a><span data-ttu-id="372bc-216">Altre modifiche di provider di Entity Framework 6</span><span class="sxs-lookup"><span data-stu-id="372bc-216">Additional EF6 provider changes</span></span>

### <a name="spatial-provider-changes"></a><span data-ttu-id="372bc-217">Modifiche apportate al provider spaziali</span><span class="sxs-lookup"><span data-stu-id="372bc-217">Spatial provider changes</span></span>

<span data-ttu-id="372bc-218">I provider che supportano i tipi spaziali ora devono implementare alcuni metodi aggiuntivi sulle classi che derivano da DbSpatialDataReader:</span><span class="sxs-lookup"><span data-stu-id="372bc-218">Providers that support spatial types must now implement some additional methods on classes deriving from DbSpatialDataReader:</span></span>

*   `public abstract bool IsGeographyColumn(int ordinal)`
*   `public abstract bool IsGeometryColumn(int ordinal)`

<span data-ttu-id="372bc-219">Esistono anche le nuove versioni asincrone dei metodi esistenti che sono consigliabile essere sostituita in quanto le implementazioni predefinite delegare ai metodi sincroni e pertanto non vengono eseguite in modo asincrono:</span><span class="sxs-lookup"><span data-stu-id="372bc-219">There are also new asynchronous versions of existing methods that are recommended to be overridden as the default implementations delegate to the synchronous methods and therefore do not execute asynchronously:</span></span>

*   `public virtual Task<DbGeography> GetGeographyAsync(int ordinal, CancellationToken cancellationToken)`
*   `public virtual Task<DbGeometry> GetGeometryAsync(int ordinal, CancellationToken cancellationToken)`

### <a name="native-support-for-enumerablecontains"></a><span data-ttu-id="372bc-220">Supporto nativo di Enumerable</span><span class="sxs-lookup"><span data-stu-id="372bc-220">Native support for Enumerable.Contains</span></span>

<span data-ttu-id="372bc-221">EF6 introduce un nuovo tipo di espressione, DbInExpression, che è stato aggiunto per risolvere i problemi di prestazioni per l'uso di Enumerable nelle query LINQ.</span><span class="sxs-lookup"><span data-stu-id="372bc-221">EF6 introduces a new expression type, DbInExpression, which was added to address performance issues around use of Enumerable.Contains in LINQ queries.</span></span> <span data-ttu-id="372bc-222">La classe DbProviderManifest dispone di un nuovo metodo virtuale, SupportsInExpression, che viene chiamato da Entity Framework per determinare se un provider gestisce il nuovo tipo di espressione.</span><span class="sxs-lookup"><span data-stu-id="372bc-222">The DbProviderManifest class has a new virtual method, SupportsInExpression, which is called by EF to determine if a provider handles the new expression type.</span></span> <span data-ttu-id="372bc-223">Per garantire la compatibilità con le implementazioni del provider esistente, il metodo restituisce false.</span><span class="sxs-lookup"><span data-stu-id="372bc-223">For compatibility with existing provider implementations the method returns false.</span></span> <span data-ttu-id="372bc-224">Per poter usufruire di questo miglioramento, un provider di Entity Framework 6 può aggiungere codice per gestire DbInExpression ed eseguire l'override SupportsInExpression a restituire true.</span><span class="sxs-lookup"><span data-stu-id="372bc-224">To benefit from this improvement, an EF6 provider can add code to handle DbInExpression and override SupportsInExpression to return true.</span></span> <span data-ttu-id="372bc-225">È possibile creare un'istanza di DbInExpression chiamando il metodo DbExpressionBuilder.In.</span><span class="sxs-lookup"><span data-stu-id="372bc-225">An instance of DbInExpression can be created by calling the DbExpressionBuilder.In method.</span></span> <span data-ttu-id="372bc-226">Un'istanza di DbInExpression è costituita da un DbExpression, in genere che rappresenta una colonna di tabella e un elenco di DbConstantExpression da testare per trovare una corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="372bc-226">A DbInExpression instance is composed of a DbExpression, usually representing a table column, and a list of DbConstantExpression to test for a match.</span></span>

## <a name="nuget-packages-for-providers"></a><span data-ttu-id="372bc-227">Pacchetti NuGet per i provider</span><span class="sxs-lookup"><span data-stu-id="372bc-227">NuGet packages for providers</span></span>

<span data-ttu-id="372bc-228">Un modo per rendere disponibile un provider di Entity Framework 6 è rilasciarlo come pacchetto NuGet.</span><span class="sxs-lookup"><span data-stu-id="372bc-228">One way to make an EF6 provider available is to release it as a NuGet package.</span></span> <span data-ttu-id="372bc-229">Uso di un pacchetto NuGet offre i vantaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="372bc-229">Using a NuGet package has the following advantages:</span></span>

*   <span data-ttu-id="372bc-230">È facile da usare NuGet per aggiungere la registrazione del provider al file di configurazione dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="372bc-230">It is easy to use NuGet to add the provider registration to the application’s config file</span></span>
*   <span data-ttu-id="372bc-231">È possibile apportare altre modifiche al file di configurazione per impostare la factory di connessione predefinito in modo che le connessioni stabilite dalla convenzione utilizzerà il provider registrato</span><span class="sxs-lookup"><span data-stu-id="372bc-231">Additional changes can be made to the config file to set the default connection factory so that connections made by convention will use the registered provider</span></span>
*   <span data-ttu-id="372bc-232">NuGet gestisce aggiungere reindirizzamenti di associazione in modo che il provider di Entity Framework 6 continueranno a funzionare anche dopo il rilascio di un nuovo pacchetto di Entity Framework</span><span class="sxs-lookup"><span data-stu-id="372bc-232">NuGet handles adding binding redirects so that the EF6 provider should continue to work even after a new EF package is released</span></span>

<span data-ttu-id="372bc-233">Un esempio di questo è il pacchetto EntityFramework.SqlServerCompact incluso nel [open source codebase](http://github.com/aspnet/entityframework6).</span><span class="sxs-lookup"><span data-stu-id="372bc-233">An example of this is the EntityFramework.SqlServerCompact package which is included in the [open source codebase](http://github.com/aspnet/entityframework6).</span></span> <span data-ttu-id="372bc-234">Questo pacchetto fornisce un modello ottimo per la creazione di pacchetti NuGet del provider di Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="372bc-234">This package provides a good template for creating EF provider NuGet packages.</span></span>

### <a name="powershell-commands"></a><span data-ttu-id="372bc-235">Comandi di PowerShell</span><span class="sxs-lookup"><span data-stu-id="372bc-235">PowerShell commands</span></span>

<span data-ttu-id="372bc-236">Quando viene installato il pacchetto EntityFramework NuGet registra un modulo di PowerShell che contiene i due comandi che sono molto utili per i pacchetti di provider:</span><span class="sxs-lookup"><span data-stu-id="372bc-236">When the EntityFramework NuGet package is installed it registers a PowerShell module that contains two commands that are very useful for provider packages:</span></span>

*   <span data-ttu-id="372bc-237">Aggiungere-EFProvider aggiunge una nuova entità per il provider nel file di configurazione del progetto di destinazione e assicura che si trova alla fine dell'elenco dei provider registrati.</span><span class="sxs-lookup"><span data-stu-id="372bc-237">Add-EFProvider adds a new entity for the provider in the target project’s configuration file and makes sure it is at the end of the list of registered providers.</span></span>
*   <span data-ttu-id="372bc-238">Aggiungere-EFDefaultConnectionFactory aggiunge o aggiorna la registrazione defaultConnectionFactory nel file di configurazione del progetto di destinazione.</span><span class="sxs-lookup"><span data-stu-id="372bc-238">Add-EFDefaultConnectionFactory either adds or updates the defaultConnectionFactory registration in the target project’s configuration file.</span></span>

<span data-ttu-id="372bc-239">Entrambi questi comandi ci occupiamo dell'aggiunta di una sezione di entityFramework al file di configurazione e una raccolta di provider se necessario.</span><span class="sxs-lookup"><span data-stu-id="372bc-239">Both these commands take care of adding an entityFramework section to the config file and adding a providers collection if necessary.</span></span>

<span data-ttu-id="372bc-240">Lo scopo è che questi comandi chiamato da install.ps1 NuGet script.</span><span class="sxs-lookup"><span data-stu-id="372bc-240">It is intended that these commands be called from the install.ps1 NuGet script.</span></span> <span data-ttu-id="372bc-241">Ad esempio, per il provider di SQL Compact install.ps1 è simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="372bc-241">For example, install.ps1 for the SQL Compact provider looks similar to this:</span></span>

``` powershell
param($installPath, $toolsPath, $package, $project)
Add-EFDefaultConnectionFactory $project 'System.Data.Entity.Infrastructure.SqlCeConnectionFactory, EntityFramework' -ConstructorArguments 'System.Data.SqlServerCe.4.0'
Add-EFProvider $project 'System.Data.SqlServerCe.4.0' 'System.Data.Entity.SqlServerCompact.SqlCeProviderServices, EntityFramework.SqlServerCompact'</pre>
```

<span data-ttu-id="372bc-242">Altre informazioni su questi comandi possono essere ottenute usando get-help nella finestra della Console di gestione pacchetti.</span><span class="sxs-lookup"><span data-stu-id="372bc-242">More information about these commands can be obtained by using get-help in the Package Manager Console window.</span></span>

## <a name="wrapping-providers"></a><span data-ttu-id="372bc-243">Provider di ritorno a capo</span><span class="sxs-lookup"><span data-stu-id="372bc-243">Wrapping providers</span></span>

<span data-ttu-id="372bc-244">Un provider di ritorno a capo è un provider di Entity Framework e/o ADO.NET che esegue il wrapping di un provider esistente per estenderlo con altre funzionalità, ad esempio di profilatura o funzionalità di traccia.</span><span class="sxs-lookup"><span data-stu-id="372bc-244">A wrapping provider is an EF and/or ADO.NET provider that wraps an existing provider to extend it with other functionality such as profiling or tracing capabilities.</span></span> <span data-ttu-id="372bc-245">Ritorno a capo provider può essere registrato in modo normale, ma è spesso più pratico configurare il provider di ritorno a capo in fase di esecuzione mediante l'intercettazione la risoluzione dei servizi relativi al provider.</span><span class="sxs-lookup"><span data-stu-id="372bc-245">Wrapping providers can be registered in the normal way, but it is often more convenient to setup the wrapping provider at runtime by intercepting the resolution of provider-related services.</span></span> <span data-ttu-id="372bc-246">L'evento statico OnLockingConfiguration sulla classe DbConfiguration può essere utilizzato per eseguire questa operazione.</span><span class="sxs-lookup"><span data-stu-id="372bc-246">The static event OnLockingConfiguration on the DbConfiguration class can be used to do this.</span></span>

<span data-ttu-id="372bc-247">OnLockingConfiguration viene chiamato dopo che ha determinato EF dove verrà ottenuti dal tutta la configurazione di Entity Framework per il dominio dell'applicazione ma prima che venga bloccato per l'uso.</span><span class="sxs-lookup"><span data-stu-id="372bc-247">OnLockingConfiguration is called after EF has determined where all EF configuration for the app domain will be obtained from but before it is locked for use.</span></span> <span data-ttu-id="372bc-248">All'avvio dell'app (prima che venga utilizzato Entity Framework) l'app deve registrare un gestore eventi per questo evento.</span><span class="sxs-lookup"><span data-stu-id="372bc-248">At app startup (before EF is used) the app should register an event handler for this event.</span></span> <span data-ttu-id="372bc-249">(Si sta considerando di aggiunta del supporto per la registrazione di questo gestore nel file di configurazione ma non è ancora supportato). Il gestore eventi deve quindi effettuare una chiamata a ReplaceService per ogni servizio che deve essere inserito.</span><span class="sxs-lookup"><span data-stu-id="372bc-249">(We are considering adding support for registering this handler in the config file but this is not yet supported.) The event handler should then make a call to ReplaceService for every service that needs to be wrapped.</span></span>  

<span data-ttu-id="372bc-250">Ad esempio, per eseguire il wrapping IDbConnectionFactory e DbProviderService, un gestore simile al seguente deve essere registrato:</span><span class="sxs-lookup"><span data-stu-id="372bc-250">For example, to wrap IDbConnectionFactory and DbProviderService, a handler something like this should be registered:</span></span>

``` csharp
DbConfiguration.OnLockingConfiguration +=
    (_, a) =>
    {
        a.ReplaceService<DbProviderServices>(
            (s, k) => new MyWrappedProviderServices(s));

        a.ReplaceService<IDbConnectionFactory>(
            (s, k) => new MyWrappedConnectionFactory(s));
    };
```

<span data-ttu-id="372bc-251">Il servizio che è stato risolto e ora deve essere incluso insieme alla chiave che è stata usata per risolvere il servizio vengono passati al gestore.</span><span class="sxs-lookup"><span data-stu-id="372bc-251">The service that has been resolved and should now be wrapped together with the key that was used to resolve the service are passed to the handler.</span></span> <span data-ttu-id="372bc-252">Il gestore può quindi eseguire il wrapping di questo servizio e sostituire il servizio restituito con la versione sottoposta a wrapping.</span><span class="sxs-lookup"><span data-stu-id="372bc-252">The handler can then wrap this service and replace the returned service with the wrapped version.</span></span>

## <a name="resolving-a-dbproviderfactory-with-ef"></a><span data-ttu-id="372bc-253">Risoluzione di un oggetto DbProviderFactory con Entity Framework</span><span class="sxs-lookup"><span data-stu-id="372bc-253">Resolving a DbProviderFactory with EF</span></span>

<span data-ttu-id="372bc-254">Oggetto DbProviderFactory è uno dei tipi di provider fondamentali necessari da Entity Framework, come descritto nel _Panoramica di Provider di tipi_ sezione precedente.</span><span class="sxs-lookup"><span data-stu-id="372bc-254">DbProviderFactory is one of the fundamental provider types needed by EF as described in the _Provider types overview_ section above.</span></span> <span data-ttu-id="372bc-255">Come già accennato, non è un tipo di Entity Framework e in genere non fa parte della configurazione di Entity Framework di registrazione, ma viene invece la registrazione del provider ADO.NET normale nel file Machine. config e/o file di configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="372bc-255">As already mentioned, It is not an EF type and registration is usually not part of EF configuration, but is instead the normal ADO.NET provider registration in the machine.config file and/or application’s config file.</span></span>

<span data-ttu-id="372bc-256">Nonostante questo EF Usa ancora il relativo meccanismo di risoluzione dipendenza normale durante la ricerca di una classe DbProviderFactory da utilizzare.</span><span class="sxs-lookup"><span data-stu-id="372bc-256">Despite this EF still uses its normal dependency resolution mechanism when looking for a DbProviderFactory to use.</span></span> <span data-ttu-id="372bc-257">Il resolver predefinito Usa la registrazione ADO.NET normale nei file di configurazione e quindi, questa è solitamente trasparente all'utente.</span><span class="sxs-lookup"><span data-stu-id="372bc-257">The default resolver uses the normal ADO.NET registration in the config files and so this is usually transparent.</span></span> <span data-ttu-id="372bc-258">Ma a causa di risoluzione delle dipendenze normale meccanismo viene usato significa che un IDbDependencyResolver può essere usato per risolvere una classe DbProviderFactory anche quando il normale ADO.NET registrazione non è stata eseguita.</span><span class="sxs-lookup"><span data-stu-id="372bc-258">But because of the normal dependency resolution mechanism is used it means that an IDbDependencyResolver can be used to resolve a DbProviderFactory even when normal ADO.NET registration has not been done.</span></span>

<span data-ttu-id="372bc-259">La risoluzione di DbProviderFactory in questo modo presenta diverse implicazioni:</span><span class="sxs-lookup"><span data-stu-id="372bc-259">Resolving DbProviderFactory in this way has several implications:</span></span>

*   <span data-ttu-id="372bc-260">Un'applicazione utilizzando la configurazione basata su codice è possibile aggiungere le chiamate all'interno della classe DbConfiguration per registrare l'elemento DbProviderFactory in appropriato.</span><span class="sxs-lookup"><span data-stu-id="372bc-260">An application using code-based configuration can add calls in their DbConfiguration class to register the appropriate DbProviderFactory.</span></span> <span data-ttu-id="372bc-261">Ciò è particolarmente utile per le applicazioni che non si desiderano (o non possono) apportare usare affatto di qualsiasi configurazione basata su file.</span><span class="sxs-lookup"><span data-stu-id="372bc-261">This is especially useful for applications that do not want to (or cannot) make use of any file-based configuration at all.</span></span>
*   <span data-ttu-id="372bc-262">Il servizio può essere eseguito il wrapping o sostituito utilizzando ReplaceService come descritto nel _Wrapping provider_ sezione precedente</span><span class="sxs-lookup"><span data-stu-id="372bc-262">The service can be wrapped or replaced using ReplaceService as described in the _Wrapping providers_ section above</span></span>
*   <span data-ttu-id="372bc-263">Un'implementazione di DbProviderServices teoricamente, è possibile risolvere una classe DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="372bc-263">Theoretically, a DbProviderServices implementation could resolve a DbProviderFactory.</span></span>

<span data-ttu-id="372bc-264">Il punto importante da notare circa effettivamente eseguendo alcuna di queste operazioni è che essi influiranno solo la ricerca di DbProviderFactory da Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="372bc-264">The important point to note about doing any of these things is that they will only affect the lookup of DbProviderFactory by EF.</span></span> <span data-ttu-id="372bc-265">Altro codice non EF potrebbe comunque prevede che il provider ADO.NET da registrare in modo normale e può non riuscire se la registrazione non viene trovata.</span><span class="sxs-lookup"><span data-stu-id="372bc-265">Other non-EF code may still expect the ADO.NET provider to be registered in the normal way and may fail if the registration is not found.</span></span> <span data-ttu-id="372bc-266">Per questo motivo è preferibile in genere per una classe DbProviderFactory essere registrato in modo normale ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="372bc-266">For this reason it is normally better for a DbProviderFactory to be registered in the normal ADO.NET way.</span></span>

### <a name="related-services"></a><span data-ttu-id="372bc-267">Servizi correlati</span><span class="sxs-lookup"><span data-stu-id="372bc-267">Related services</span></span>

<span data-ttu-id="372bc-268">Se Entity Framework viene usato per risolvere una classe DbProviderFactory, inoltre consigliabile risolvere i servizi IProviderInvariantName e IDbProviderFactoryResolver.</span><span class="sxs-lookup"><span data-stu-id="372bc-268">If EF is used to resolve a DbProviderFactory, then it should also resolve the IProviderInvariantName and IDbProviderFactoryResolver services.</span></span>

<span data-ttu-id="372bc-269">IProviderInvariantName è un servizio che consente di determinare un nome invariante del provider per un determinato tipo di oggetto DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="372bc-269">IProviderInvariantName is a service that is used to determine a provider invariant name for a given type of DbProviderFactory.</span></span> <span data-ttu-id="372bc-270">L'implementazione predefinita di questo servizio Usa la registrazione del provider ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="372bc-270">The default implementation of this service uses the ADO.NET provider registration.</span></span> <span data-ttu-id="372bc-271">Ciò significa che se il provider ADO.NET non è registrato in modo normale perché è in fase di risoluzione DbProviderFactory da Entity Framework, quindi verrà anche essere necessario risolvere questo servizio.</span><span class="sxs-lookup"><span data-stu-id="372bc-271">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span> <span data-ttu-id="372bc-272">Si noti che un sistema di risoluzione per questo servizio viene aggiunto automaticamente quando si usa il metodo DbConfiguration.SetProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="372bc-272">Note that a resolver for this service is automatically added when using the DbConfiguration.SetProviderFactory method.</span></span>

<span data-ttu-id="372bc-273">Come descritto nel _Panoramica di Provider di tipi_ sezione precedente, il IDbProviderFactoryResolver viene usato per ottenere l'elemento DbProviderFactory in corretto da un oggetto DbConnection specificato.</span><span class="sxs-lookup"><span data-stu-id="372bc-273">As described in the _Provider types overview_ section above, the IDbProviderFactoryResolver is used to obtain the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="372bc-274">L'implementazione predefinita di questo servizio durante l'esecuzione in .NET 4 utilizza la registrazione del provider ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="372bc-274">The default implementation of this service when running on .NET 4 uses the ADO.NET provider registration.</span></span> <span data-ttu-id="372bc-275">Ciò significa che se il provider ADO.NET non è registrato in modo normale perché è in fase di risoluzione DbProviderFactory da Entity Framework, quindi verrà anche essere necessario risolvere questo servizio.</span><span class="sxs-lookup"><span data-stu-id="372bc-275">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span>
