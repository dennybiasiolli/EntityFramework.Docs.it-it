---
title: Entità con rilevamento automatico - EF6
author: divega
ms.date: 2016-10-23
ms.prod: entity-framework
ms.author: divega
ms.manager: avickers
ms.technology: entity-framework-6
ms.topic: article
ms.assetid: 5e60f5be-7bbb-4bf8-835e-0ac808d6c84a
caps.latest.revision: 3
ms.openlocfilehash: 2fb4e9f4d4008c57e90c49a011bebb320eb2bb58
ms.sourcegitcommit: 45494121254ad4fdcec613d1dd22d850068d6f39
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 07/08/2018
ms.locfileid: "37913525"
---
# <a name="self-tracking-entities"></a><span data-ttu-id="c5380-102">Entità con rilevamento automatico</span><span class="sxs-lookup"><span data-stu-id="c5380-102">Self-tracking entities</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c5380-103">Non è più consigliabile usare il modello di entità con rilevamento automatico.</span><span class="sxs-lookup"><span data-stu-id="c5380-103">We no longer recommend using the self-tracking-entities template.</span></span> <span data-ttu-id="c5380-104">Continuerà a essere disponibile solo per supportare le applicazioni esistenti.</span><span class="sxs-lookup"><span data-stu-id="c5380-104">It will only continue to be available to support existing applications.</span></span> <span data-ttu-id="c5380-105">Se l'applicazione richiede l'uso con grafici di entità disconnesse, prendere in considerazione altre alternative, come ad esempio [Trackable Entities](http://trackableentities.github.io/), che è una tecnologia simile alle entità con rilevamento automatico ma viene sviluppata in modo più attivo dalla community, oppure la scrittura di codice personalizzato usando le API di rilevamento delle modifiche di basso livello.</span><span class="sxs-lookup"><span data-stu-id="c5380-105">If your application requires working with disconnected graphs of entities, consider other alternatives such as [Trackable Entities](http://trackableentities.github.io/), which is a technology similar to Self-Tracking-Entities that is more actively developed by the community, or writing custom code using the low-level change tracking APIs.</span></span>

<span data-ttu-id="c5380-106">In un'applicazione basata su Entity Framework il rilevamento delle modifiche negli oggetti viene controllato da un contesto.</span><span class="sxs-lookup"><span data-stu-id="c5380-106">In an Entity Framework-based application, a context is responsible for tracking changes in your objects.</span></span> <span data-ttu-id="c5380-107">Viene quindi usato il metodo SaveChanges per rendere permanenti le modifiche al database.</span><span class="sxs-lookup"><span data-stu-id="c5380-107">You then use the SaveChanges method to persist the changes to the database.</span></span> <span data-ttu-id="c5380-108">Quando si usano le applicazioni a più livelli, gli oggetti entità vengono in genere disconnessi dal contesto ed è necessario decidere come tenere traccia delle modifiche e segnalarle al contesto.</span><span class="sxs-lookup"><span data-stu-id="c5380-108">When working with N-Tier applications, the entity objects are usually disconnected from the context and you must decide how to track changes and report those changes back to the context.</span></span> <span data-ttu-id="c5380-109">Le entità con rilevamento automatico consentono di tenere traccia delle modifiche in qualsiasi livello e di riprodurle quindi in un contesto per essere salvate.</span><span class="sxs-lookup"><span data-stu-id="c5380-109">Self-Tracking Entities (STEs) can help you track changes in any tier and then replay these changes into a context to be saved.</span></span>  

<span data-ttu-id="c5380-110">Usare le entità con rilevamento automatico solo se il contesto non è disponibile nel livello in cui vengono apportate le modifiche all'oggetto grafico.</span><span class="sxs-lookup"><span data-stu-id="c5380-110">Use STEs only if the context is not available on a tier where the changes to the object graph are made.</span></span> <span data-ttu-id="c5380-111">Se il contesto è disponibile, non è necessario usare le entità con rilevamento automatico poiché il contesto terrà traccia delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="c5380-111">If the context is available, there is no need to use STEs because the context will take care of tracking changes.</span></span>  

<span data-ttu-id="c5380-112">Questo elemento di modello genera due file con estensione tt (modello di testo):</span><span class="sxs-lookup"><span data-stu-id="c5380-112">This template item generates two .tt (text template) files:</span></span>  

- <span data-ttu-id="c5380-113">Il file **\<nome modello\>.tt** genera i tipi di entità e una classe helper contenente la logica di rilevamento delle modifiche usata dalle entità con rilevamento automatico, nonché i metodi di estensione che consentono l'impostazione dello stato sulle entità con rilevamento automatico.</span><span class="sxs-lookup"><span data-stu-id="c5380-113">The **\<model name\>.tt** file generates the entity types and a helper class that contains the change-tracking logic that is used by self-tracking entities and the extension methods that allow setting state on self-tracking entities.</span></span>  
- <span data-ttu-id="c5380-114">Il file **\<nome modello\>.Context.tt** genera un contesto derivato e una classe di estensione contenente i metodi **ApplyChanges** per le classi **ObjectContext** e **ObjectSet**.</span><span class="sxs-lookup"><span data-stu-id="c5380-114">The **\<model name\>.Context.tt** file generates a derived context and an extension class that contains **ApplyChanges** methods for the **ObjectContext** and **ObjectSet** classes.</span></span> <span data-ttu-id="c5380-115">Tali metodi consentono di esaminare le informazioni sul rilevamento delle modifiche contenute nel grafico delle entità con rilevamento automatico per dedurre il set di operazioni che è necessario eseguire per salvare le modifiche nel database.</span><span class="sxs-lookup"><span data-stu-id="c5380-115">These methods examine the change-tracking information that is contained in the graph of self-tracking entities to infer the set of operations that must be performed to save the changes in the database.</span></span>  

## <a name="get-started"></a><span data-ttu-id="c5380-116">Introduzione</span><span class="sxs-lookup"><span data-stu-id="c5380-116">Get Started</span></span>  

<span data-ttu-id="c5380-117">Per iniziare, visitare la pagina [Self-Tracking Entities Walkthrough](walkthrough.md) (Entità con rilevamento automatico - Procedura dettagliata).</span><span class="sxs-lookup"><span data-stu-id="c5380-117">To get started, visit the [Self-Tracking Entities Walkthrough](walkthrough.md) page.</span></span>  

## <a name="considerations-when-working-with-self-tracking-entities"></a><span data-ttu-id="c5380-118">Considerazioni relative all'utilizzo delle entità con rilevamento automatico</span><span class="sxs-lookup"><span data-stu-id="c5380-118">Considerations When Working with Self-Tracking Entities</span></span>  
> [!IMPORTANT]
> <span data-ttu-id="c5380-119">Non è più consigliabile usare il modello di entità con rilevamento automatico.</span><span class="sxs-lookup"><span data-stu-id="c5380-119">We no longer recommend using the self-tracking-entities template.</span></span> <span data-ttu-id="c5380-120">Continuerà a essere disponibile solo per supportare le applicazioni esistenti.</span><span class="sxs-lookup"><span data-stu-id="c5380-120">It will only continue to be available to support existing applications.</span></span> <span data-ttu-id="c5380-121">Se l'applicazione richiede l'uso con grafici di entità disconnesse, prendere in considerazione altre alternative, come ad esempio [Trackable Entities](http://trackableentities.github.io/), che è una tecnologia simile alle entità con rilevamento automatico ma viene sviluppata in modo più attivo dalla community, oppure la scrittura di codice personalizzato usando le API di rilevamento delle modifiche di basso livello.</span><span class="sxs-lookup"><span data-stu-id="c5380-121">If your application requires working with disconnected graphs of entities, consider other alternatives such as [Trackable Entities](http://trackableentities.github.io/), which is a technology similar to Self-Tracking-Entities that is more actively developed by the community, or writing custom code using the low-level change tracking APIs.</span></span>

<span data-ttu-id="c5380-122">Quando si utilizzano le entità con rilevamento automatico, tenere presenti le considerazioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="c5380-122">Consider the following when working with self-tracking entities:</span></span>  

- <span data-ttu-id="c5380-123">Verificare che il progetto client disponga di un riferimento all'assembly che contiene i tipi di entità.</span><span class="sxs-lookup"><span data-stu-id="c5380-123">Make sure that your client project has a reference to the assembly containing the entity types.</span></span> <span data-ttu-id="c5380-124">Se si aggiunge solo il riferimento al servizio al progetto client, il progetto client utilizzerà i tipi proxy WCF e non i tipi di entità con rilevamento automatico effettivi.</span><span class="sxs-lookup"><span data-stu-id="c5380-124">If you add only the service reference to the client project, the client project will use the WCF proxy types and not the actual self-tracking entity types.</span></span> <span data-ttu-id="c5380-125">Ciò significa che non si otterranno le funzioni di notifica automatica che gestiscono il rilevamento delle entità sul client.</span><span class="sxs-lookup"><span data-stu-id="c5380-125">This means that you will not get the automated notification features that manage the tracking of the entities on the client.</span></span> <span data-ttu-id="c5380-126">Se non si desidera includere intenzionalmente i tipi di entità, sarà necessario impostare manualmente le informazioni sul rilevamento delle modifiche sul client affinché le modifiche vengano restituite al servizio.</span><span class="sxs-lookup"><span data-stu-id="c5380-126">If you intentionally do not want to include the entity types, you will have to manually set change-tracking information on the client for the changes to be sent back to the service.</span></span>  
- <span data-ttu-id="c5380-127">Le chiamate all'operazione del servizio devono essere senza stato e creare una nuova istanza di contesto dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="c5380-127">Calls to the service operation should be stateless and create a new instance of object context.</span></span> <span data-ttu-id="c5380-128">Si consiglia anche di creare il contesto dell'oggetto in un blocco **using**.</span><span class="sxs-lookup"><span data-stu-id="c5380-128">We also recommend that you create object context in a **using** block.</span></span>  
- <span data-ttu-id="c5380-129">Quando si invia al servizio il grafico modificato nel client e si intende continuare a lavorare sullo stesso grafico nel client, è necessario scorrere manualmente il grafico e chiamare il metodo **AcceptChanges** su ogni oggetto per reimpostare la funzione di rilevamento delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="c5380-129">When you send the graph that was modified on the client to the service and then intend to continue working with the same graph on the client, you have to manually iterate through the graph and call the **AcceptChanges** method on each object to reset the change tracker.</span></span>  

    > <span data-ttu-id="c5380-130">Se gli oggetti nel grafico contengono proprietà con valori generati dal database (ad esempio, valori di identità o concorrenza), Entity Framework sostituirà i valori di queste proprietà con i valori generati dal database dopo la chiamata al metodo **SaveChanges**.</span><span class="sxs-lookup"><span data-stu-id="c5380-130">If objects in your graph contain properties with database-generated values (for example, identity or concurrency values), Entity Framework will replace values of these properties with the database-generated values after the **SaveChanges** method is called.</span></span> <span data-ttu-id="c5380-131">È possibile implementare l'operazione del servizio in modo che restituisca al client gli oggetti salvati o un elenco di valori di proprietà generati per gli oggetti.</span><span class="sxs-lookup"><span data-stu-id="c5380-131">You can implement your service operation to return saved objects or a list of generated property values for the objects back to the client.</span></span> <span data-ttu-id="c5380-132">Il client dovrebbe quindi sostituire le istanze dell'oggetto o i valori di proprietà dell'oggetto con gli oggetti o i valori di proprietà restituiti dall'operazione del servizio.</span><span class="sxs-lookup"><span data-stu-id="c5380-132">The client would then need to replace the object instances or object property values with the objects or property values returned from the service operation.</span></span>  
- <span data-ttu-id="c5380-133">È possibile che l'unione di grafici da più richieste del servizio introduca oggetti con valori di chiave duplicati nel grafico risultante.</span><span class="sxs-lookup"><span data-stu-id="c5380-133">Merging graphs from multiple service requests may introduce objects with duplicate key values in the resulting graph.</span></span> <span data-ttu-id="c5380-134">Entity Framework non rimuove gli oggetti con chiavi duplicate quando viene chiamato il metodo **ApplyChanges**, ma genera un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="c5380-134">Entity Framework does not remove the objects with duplicate keys when you call the **ApplyChanges** method but instead throws an exception.</span></span> <span data-ttu-id="c5380-135">Per evitare di avere grafici con valori di chiave duplicati, seguire uno dei modelli descritti nel blog seguente: [Self-Tracking Entities: ApplyChanges and duplicate entities](http://go.microsoft.com/fwlink/?LinkID=205119&clcid=0x409) (Entità con rilevamento automatico: ApplyChanges ed entità duplicate).</span><span class="sxs-lookup"><span data-stu-id="c5380-135">To avoid having graphs with duplicate key values follow one of the patterns described in the following blog: [Self-Tracking Entities: ApplyChanges and duplicate entities](http://go.microsoft.com/fwlink/?LinkID=205119&clcid=0x409).</span></span>  
- <span data-ttu-id="c5380-136">Quando si modifica la relazione tra oggetti impostando la proprietà della chiave esterna, la proprietà di navigazione di riferimento viene impostata su null e non viene sincronizzata con l'entità principale appropriata sul client.</span><span class="sxs-lookup"><span data-stu-id="c5380-136">When you change the relationship between objects by setting the foreign key property, the reference navigation property is set to null and not synchronized to the appropriate principal entity on the client.</span></span> <span data-ttu-id="c5380-137">Dopo che il grafico è stato collegato al contesto dell'oggetto (ad esempio, dopo la chiamata al metodo **ApplyChanges**), le proprietà di chiave esterna e le proprietà di navigazione vengono sincronizzate.</span><span class="sxs-lookup"><span data-stu-id="c5380-137">After the graph is attached to the object context (for example, after you call the **ApplyChanges** method), the foreign key properties and navigation properties are synchronized.</span></span>  

    > <span data-ttu-id="c5380-138">Non avere una proprietà di navigazione di riferimento sincronizzata con l'oggetto principale appropriato potrebbe essere un problema se è stata specificata l'eliminazione a catena sulla relazione di chiave esterna.</span><span class="sxs-lookup"><span data-stu-id="c5380-138">Not having a reference navigation property synchronized with the appropriate principal object could be an issue if you have specified cascade delete on the foreign key relationship.</span></span> <span data-ttu-id="c5380-139">L'eventuale eliminazione dell'oggetto principale non sarà propagata agli oggetti dipendenti.</span><span class="sxs-lookup"><span data-stu-id="c5380-139">If you delete the principal, the delete will not be propagated to the dependent objects.</span></span> <span data-ttu-id="c5380-140">Se sono state specificate eliminazioni a catena, utilizzare le proprietà di navigazione per modificare le relazioni anziché impostare la proprietà della chiave esterna.</span><span class="sxs-lookup"><span data-stu-id="c5380-140">If you have cascade deletes specified, use navigation properties to change relationships instead of setting the foreign key property.</span></span>  
- <span data-ttu-id="c5380-141">Le entità con rilevamento automatico non sono abilitate per eseguire il caricamento lazy.</span><span class="sxs-lookup"><span data-stu-id="c5380-141">Self-tracking entities are not enabled to perform lazy loading.</span></span>  
- <span data-ttu-id="c5380-142">La serializzazione binaria e la serializzazione agli oggetti della gestione dello stato di ASP.NET non sono supportate dalle entità con rilevamento automatico.</span><span class="sxs-lookup"><span data-stu-id="c5380-142">Binary serialization and serialization to ASP.NET state management objects is not supported by self-tracking entities.</span></span> <span data-ttu-id="c5380-143">Tuttavia, è possibile personalizzare il modello in modo da aggiungere il supporto per la serializzazione binaria.</span><span class="sxs-lookup"><span data-stu-id="c5380-143">However, you can customize the template to add the binary serialization support.</span></span> <span data-ttu-id="c5380-144">Per altre informazioni, vedere [Using Binary Serialization and ViewState with Self-Tracking Entities](http://go.microsoft.com/fwlink/?LinkId=199208) (Uso della serializzazione binaria e di ViewState con le entità con rilevamento automatico).</span><span class="sxs-lookup"><span data-stu-id="c5380-144">For more information, see [Using Binary Serialization and ViewState with Self-Tracking Entities](http://go.microsoft.com/fwlink/?LinkId=199208).</span></span>  

### <a name="security-considerations"></a><span data-ttu-id="c5380-145">Considerazioni sulla sicurezza</span><span class="sxs-lookup"><span data-stu-id="c5380-145">Security Considerations</span></span>  

<span data-ttu-id="c5380-146">Quando si usano le entità con rilevamento automatico tenere a mente di queste considerazioni sulla sicurezza:</span><span class="sxs-lookup"><span data-stu-id="c5380-146">The following security considerations should be taken into account when working with self-tracking entities:</span></span>  

- <span data-ttu-id="c5380-147">Un servizio non dovrebbe ritenere attendibili le richieste di recuperare o aggiornare dati da un client non attendibile o tramite un canale non attendibile.</span><span class="sxs-lookup"><span data-stu-id="c5380-147">A service should not trust requests to retrieve or update data from a non-trusted client or through a non-trusted channel.</span></span> <span data-ttu-id="c5380-148">È necessario autenticare un client: dovrebbe essere utilizzato un canale sicuro o un envelop del messaggio.</span><span class="sxs-lookup"><span data-stu-id="c5380-148">A client must be authenticated: a secure channel or message envelope should be used.</span></span> <span data-ttu-id="c5380-149">È necessario convalidare le richieste dei client di aggiornare o recuperare i dati per assicurarsi che siano conformi alle modifiche previste e legittime per lo scenario specificato.</span><span class="sxs-lookup"><span data-stu-id="c5380-149">Clients' requests to update or retrieve data must be validated to ensure they conform to expected and legitimate changes for the given scenario.</span></span>  
- <span data-ttu-id="c5380-150">Evitare di utilizzare informazioni sensibili come chiavi di entità, ad esempio numeri di previdenza sociale.</span><span class="sxs-lookup"><span data-stu-id="c5380-150">Avoid using sensitive information as entity keys (for example, social security numbers).</span></span> <span data-ttu-id="c5380-151">In questo modo si riduce la possibilità di serializzare inavvertitamente informazioni sensibili nei grafici dell'entità con rilevamento automatico in un client che non è completamente attendibile.</span><span class="sxs-lookup"><span data-stu-id="c5380-151">This mitigates the possibility of inadvertently serializing sensitive information in the self-tracking entity graphs to a client that is not fully trusted.</span></span> <span data-ttu-id="c5380-152">Con le associazioni indipendenti, la chiave originale di un'entità correlata a quella sottoposta a serializzazione potrebbe essere inviata anche al client.</span><span class="sxs-lookup"><span data-stu-id="c5380-152">With independent associations, the original key of an entity that is related to the one that is being serialized might be sent to the client as well.</span></span>  
- <span data-ttu-id="c5380-153">Per evitare di propagare al livello client messaggi di eccezione contenenti dati sensibili, le chiamate a **ApplyChanges** e **SaveChanges** nel livello server devono essere incapsulate nel codice di gestione delle eccezioni.</span><span class="sxs-lookup"><span data-stu-id="c5380-153">To avoid propagating exception messages that contain sensitive data to the client tier, calls to **ApplyChanges** and **SaveChanges** on the server tier should be wrapped in exception-handling code.</span></span>  
