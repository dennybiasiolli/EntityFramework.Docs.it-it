---
title: Funzionamento delle query - EF Core
author: rowanmiller
ms.date: 10/27/2016
ms.assetid: de2e34cd-659b-4cab-b5ed-7a979c6bf120
uid: core/querying/overview
ms.openlocfilehash: f1c23471bfbc998b2d4f9dc579d1404d6202e109
ms.sourcegitcommit: dadee5905ada9ecdbae28363a682950383ce3e10
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 08/27/2018
ms.locfileid: "42993203"
---
# <a name="how-queries-work"></a><span data-ttu-id="9eff7-102">Funzionamento delle query</span><span class="sxs-lookup"><span data-stu-id="9eff7-102">How Queries Work</span></span>

<span data-ttu-id="9eff7-103">Entity Framework Core usa query LINQ (Language Integrated Query) per eseguire query sui dati dal database.</span><span class="sxs-lookup"><span data-stu-id="9eff7-103">Entity Framework Core uses Language Integrated Query (LINQ) to query data from the database.</span></span> <span data-ttu-id="9eff7-104">Le query LINQ consentono di usare C#, o il linguaggio .NET che si preferisce, per generare query fortemente tipizzate in base alle classi di contesto ed entità derivate.</span><span class="sxs-lookup"><span data-stu-id="9eff7-104">LINQ allows you to use C# (or your .NET language of choice) to write strongly typed queries based on your derived context and entity classes.</span></span>

## <a name="the-life-of-a-query"></a><span data-ttu-id="9eff7-105">Ciclo di vita di una query</span><span class="sxs-lookup"><span data-stu-id="9eff7-105">The life of a query</span></span>

<span data-ttu-id="9eff7-106">Di seguito è disponibile una panoramica generale del processo di elaborazione di ogni query.</span><span class="sxs-lookup"><span data-stu-id="9eff7-106">The following is a high level overview of the process each query goes through.</span></span>

1. <span data-ttu-id="9eff7-107">La query LINQ viene elaborata da Entity Framework Core per creare una rappresentazione pronta per essere elaborata dal provider di database</span><span class="sxs-lookup"><span data-stu-id="9eff7-107">The LINQ query is processed by Entity Framework Core to build a representation that is ready to be processed by the database provider</span></span>
   1. <span data-ttu-id="9eff7-108">Il risultato viene memorizzato nella cache in modo che tale elaborazione non debba essere ripetuta per ogni esecuzione della query</span><span class="sxs-lookup"><span data-stu-id="9eff7-108">The result is cached so that this processing does not need to be done every time the query is executed</span></span>
2. <span data-ttu-id="9eff7-109">Il risultato viene passato al provider di database</span><span class="sxs-lookup"><span data-stu-id="9eff7-109">The result is passed to the database provider</span></span>
   1. <span data-ttu-id="9eff7-110">Il provider di database identifica le parti della query che possono essere valutate nel database</span><span class="sxs-lookup"><span data-stu-id="9eff7-110">The database provider identifies which parts of the query can be evaluated in the database</span></span>
   2. <span data-ttu-id="9eff7-111">Queste parti della query vengono convertite nel linguaggio di query specifico del database, ad esempio SQL per un database relazionale</span><span class="sxs-lookup"><span data-stu-id="9eff7-111">These parts of the query are translated to database specific query language (for example, SQL for a relational database)</span></span>
   3. <span data-ttu-id="9eff7-112">Una o più query vengono inviate al database e il set di risultati viene restituito (i risultati sono valori del database e non istanze di entità)</span><span class="sxs-lookup"><span data-stu-id="9eff7-112">One or more queries are sent to the database and the result set returned (results are values from the database, not entity instances)</span></span>
3. <span data-ttu-id="9eff7-113">Per ogni elemento nel set di risultati</span><span class="sxs-lookup"><span data-stu-id="9eff7-113">For each item in the result set</span></span>
   1. <span data-ttu-id="9eff7-114">Se si tratta di una query con rilevamento delle modifiche, EF controlla se i dati rappresentano un'entità già presente nello strumento di rilevamento delle modifiche per l'istanza di contesto</span><span class="sxs-lookup"><span data-stu-id="9eff7-114">If this is a tracking query, EF checks if the data represents an entity already in the change tracker for the context instance</span></span>
      * <span data-ttu-id="9eff7-115">In caso affermativo, viene restituita l'entità esistente</span><span class="sxs-lookup"><span data-stu-id="9eff7-115">If so, the existing entity is returned</span></span>
      * <span data-ttu-id="9eff7-116">In caso contrario, viene creata una nuova entità, viene configurato il rilevamento delle modifiche e viene restituita la nuova entità</span><span class="sxs-lookup"><span data-stu-id="9eff7-116">If not, a new entity is created, change tracking is setup, and the new entity is returned</span></span>
   2. <span data-ttu-id="9eff7-117">Se si tratta di una query senza rilevamento delle modifiche, EF controlla se i dati rappresentano un'entità già presente nel set di risultati per questa query</span><span class="sxs-lookup"><span data-stu-id="9eff7-117">If this is a no-tracking query, EF checks if the data represents an entity already in the result set for this query</span></span>
      * <span data-ttu-id="9eff7-118">In caso affermativo, viene restituita l'entità esistente <sup>(1)</sup></span><span class="sxs-lookup"><span data-stu-id="9eff7-118">If so, the existing entity is returned <sup>(1)</sup></span></span>
      * <span data-ttu-id="9eff7-119">In caso contrario, viene creata e restituita una nuova entità</span><span class="sxs-lookup"><span data-stu-id="9eff7-119">If not, a new entity is created and returned</span></span>

<span data-ttu-id="9eff7-120"><sup>(1) </sup> Nessuna query con rilevamento delle modifiche usa riferimenti deboli per tenere traccia delle entità già restituite.</span><span class="sxs-lookup"><span data-stu-id="9eff7-120"><sup>(1)</sup> No tracking queries use weak references to keep track of entities that have already been returned.</span></span> <span data-ttu-id="9eff7-121">Se un risultato precedente con la stessa identità esce dall'ambito e viene eseguita la Garbage Collection, si potrebbe ottenere una nuova istanza di entità.</span><span class="sxs-lookup"><span data-stu-id="9eff7-121">If a previous result with the same identity goes out of scope, and garbage collection runs, you may get a new entity instance.</span></span>

## <a name="when-queries-are-executed"></a><span data-ttu-id="9eff7-122">Quando vengono eseguite le query</span><span class="sxs-lookup"><span data-stu-id="9eff7-122">When queries are executed</span></span>

<span data-ttu-id="9eff7-123">Quando si chiamano operatori LINQ, si crea semplicemente una rappresentazione in memoria della query.</span><span class="sxs-lookup"><span data-stu-id="9eff7-123">When you call LINQ operators, you are simply building up an in-memory representation of the query.</span></span> <span data-ttu-id="9eff7-124">La query viene inviata al database solo al momento dell'utilizzo dei risultati.</span><span class="sxs-lookup"><span data-stu-id="9eff7-124">The query is only sent to the database when the results are consumed.</span></span>

<span data-ttu-id="9eff7-125">Le operazioni più comuni che causano l'invio della query al database sono:</span><span class="sxs-lookup"><span data-stu-id="9eff7-125">The most common operations that result in the query being sent to the database are:</span></span>
* <span data-ttu-id="9eff7-126">Iterazione dei risultati in un ciclo `for`</span><span class="sxs-lookup"><span data-stu-id="9eff7-126">Iterating the results in a `for` loop</span></span>
* <span data-ttu-id="9eff7-127">Uso di un operatore, ad esempio `ToList`, `ToArray`, `Single`, `Count`</span><span class="sxs-lookup"><span data-stu-id="9eff7-127">Using an operator such as `ToList`, `ToArray`, `Single`, `Count`</span></span>
* <span data-ttu-id="9eff7-128">Data binding dei risultati di una query a un'interfaccia utente</span><span class="sxs-lookup"><span data-stu-id="9eff7-128">Databinding the results of a query to a UI</span></span>

> [!WARNING]  
> <span data-ttu-id="9eff7-129">**Convalidare sempre l'input dell'utente:** anche se EF offre protezione da attacchi SQL injection, non esegue alcuna convalida generale dell'input.</span><span class="sxs-lookup"><span data-stu-id="9eff7-129">**Always validate user input:** While EF does provide protection from SQL injection attacks, it does not do any general validation of input.</span></span> <span data-ttu-id="9eff7-130">Pertanto se i valori passati alle API, usati nelle query LINQ, assegnati alle proprietà di entità e così via, provengono da un'origine non attendibile, è opportuno prevedere una convalida appropriata in base ai requisiti dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9eff7-130">Therefore if values being passed to APIs, used in LINQ queries, assigned to entity properties, etc., come from an untrusted source then appropriate validation, per your application requirements, should be performed.</span></span> <span data-ttu-id="9eff7-131">Ciò include qualsiasi input dell'utente usato per costruire query in modo dinamico.</span><span class="sxs-lookup"><span data-stu-id="9eff7-131">This includes any user input used to dynamically construct queries.</span></span> <span data-ttu-id="9eff7-132">Anche quando si usa LINQ, se si accetta l'input dell'utente per la creazione delle espressioni, è necessario assicurarsi che possano essere costruite solo le espressioni previste.</span><span class="sxs-lookup"><span data-stu-id="9eff7-132">Even when using LINQ, if you are accepting user input to build expressions you need to make sure than only intended expressions can be constructed.</span></span>
