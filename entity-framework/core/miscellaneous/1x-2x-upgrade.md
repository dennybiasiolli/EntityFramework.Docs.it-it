---
title: L'aggiornamento da versioni precedenti a EF Core 2 - Core a Entity Framework
author: divega
ms.author: divega
ms.date: 8/13/2017
ms.assetid: 8BD43C8C-63D9-4F3A-B954-7BC518A1B7DB
ms.technology: entity-framework-core
uid: core/miscellaneous/1x-2x-upgrade
ms.openlocfilehash: 0bd1ea2476621f826cca7d4a526a49a1b902acf8
ms.sourcegitcommit: 860ec5d047342fbc4063a0de881c9861cc1f8813
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/05/2017
---
# <a name="upgrading-applications-from-previous-versions-to-ef-core-20"></a><span data-ttu-id="c5b96-102">Aggiornamento di applicazioni da versioni precedenti a EF Core 2.0</span><span class="sxs-lookup"><span data-stu-id="c5b96-102">Upgrading applications from previous versions to EF Core 2.0</span></span>

## <a name="procedures-common-to-all-applications"></a><span data-ttu-id="c5b96-103">Procedure comuni a tutte le applicazioni</span><span class="sxs-lookup"><span data-stu-id="c5b96-103">Procedures Common to All Applications</span></span>

<span data-ttu-id="c5b96-104">Può richiedere l'aggiornamento di un'applicazione esistente a EF Core 2.0:</span><span class="sxs-lookup"><span data-stu-id="c5b96-104">Updating an existing application to EF Core 2.0 may require:</span></span>

1. <span data-ttu-id="c5b96-105">L'aggiornamento la piattaforma .NET di destinazione dell'applicazione che supporta .NET 2.0 Standard.</span><span class="sxs-lookup"><span data-stu-id="c5b96-105">Upgrading the target .NET platform of the application to one that supports .NET Standard 2.0.</span></span> <span data-ttu-id="c5b96-106">Vedere [piattaforme supportate](../platforms/index.md) per altri dettagli.</span><span class="sxs-lookup"><span data-stu-id="c5b96-106">See [Supported Platforms](../platforms/index.md) for more details.</span></span>

2. <span data-ttu-id="c5b96-107">Identificare il provider per il database di destinazione che è compatibile con Entity Framework Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="c5b96-107">Identify a provider for the target database which is compatible with EF Core 2.0.</span></span> <span data-ttu-id="c5b96-108">Vedere [EF Core 2.0 richiede un provider di 2.0 database](#ef-core-20-requires-a-20-database-provider) sotto.</span><span class="sxs-lookup"><span data-stu-id="c5b96-108">See [EF Core 2.0 requires a 2.0 database provider](#ef-core-20-requires-a-20-database-provider) below.</span></span>

3. <span data-ttu-id="c5b96-109">L'aggiornamento di tutti i pacchetti di EF principali (runtime e gli strumenti) a 2.0.</span><span class="sxs-lookup"><span data-stu-id="c5b96-109">Upgrading all the EF Core packages (runtime and tooling) to 2.0.</span></span> <span data-ttu-id="c5b96-110">Fare riferimento a [installazione Core EF](../get-started/install/index.md) per altri dettagli.</span><span class="sxs-lookup"><span data-stu-id="c5b96-110">Refer to [Installing EF Core](../get-started/install/index.md) for more details.</span></span>

4. <span data-ttu-id="c5b96-111">Apportare le modifiche di codice necessario per compensare le modifiche di rilievo.</span><span class="sxs-lookup"><span data-stu-id="c5b96-111">Make any necessary code changes to compensate for breaking changes.</span></span> <span data-ttu-id="c5b96-112">Vedere il [modifiche di rilievo](#breaking-changes) sezione riportata di seguito per ulteriori dettagli.</span><span class="sxs-lookup"><span data-stu-id="c5b96-112">See the [Breaking Changes](#breaking-changes) section below for more details.</span></span>

## <a name="aspnet-core-applications"></a><span data-ttu-id="c5b96-113">Applicazioni ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="c5b96-113">ASP.NET Core applications</span></span>

1. <span data-ttu-id="c5b96-114">Vedere in particolare il [nuovo modello per l'inizializzazione del provider del servizio dell'applicazione](#new-way-of-getting-application-services) descritto di seguito.</span><span class="sxs-lookup"><span data-stu-id="c5b96-114">See in particular the [new pattern for initializing the application's service provider](#new-way-of-getting-application-services) described below.</span></span>

> [!TIP]  
> <span data-ttu-id="c5b96-115">L'adozione di questo nuovo modello, quando l'aggiornamento di applicazioni a 2.0 è consigliabile ed è necessaria affinché le funzionalità del prodotto come Entity Framework Core migrazioni di lavoro.</span><span class="sxs-lookup"><span data-stu-id="c5b96-115">The adoption of this new pattern when updating applications to 2.0 is highly recommended and is required in order for product features like Entity Framework Core Migrations to work.</span></span> <span data-ttu-id="c5b96-116">L'altra alternativa comune consiste nel [implementare *IDesignTimeDbContextFactory\<TContext >*](configuring-dbcontext.md#using-idesigntimedbcontextfactorytcontext).</span><span class="sxs-lookup"><span data-stu-id="c5b96-116">The other common alternative is to [implement *IDesignTimeDbContextFactory\<TContext>*](configuring-dbcontext.md#using-idesigntimedbcontextfactorytcontext).</span></span>

2. <span data-ttu-id="c5b96-117">Applicazioni destinate alla base di ASP.NET 2.0 è possono utilizzare EF Core 2.0 senza dipendenze aggiuntive oltre a provider di database di terze parti.</span><span class="sxs-lookup"><span data-stu-id="c5b96-117">Applications targeting ASP.NET Core 2.0 can use EF Core 2.0 without additional dependencies besides third party database providers.</span></span> <span data-ttu-id="c5b96-118">Applicazioni destinate a versioni precedenti di ASP.NET Core, tuttavia, necessario eseguire l'aggiornamento a componenti di base di ASP.NET 2.0 per poter utilizzare EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="c5b96-118">However, applications targeting previous versions of ASP.NET Core need to upgrade to ASP.NET Core 2.0 in order to use EF Core 2.0.</span></span> <span data-ttu-id="c5b96-119">Per ulteriori informazioni sull'aggiornamento delle applicazioni ASP.NET Core a 2.0, vedere [la documentazione di base di ASP.NET in materia](https://docs.microsoft.com/aspnet/core/migration/1x-to-2x/).</span><span class="sxs-lookup"><span data-stu-id="c5b96-119">For more details on upgrading ASP.NET Core applications to 2.0 see [the ASP.NET Core documentation on the subject](https://docs.microsoft.com/aspnet/core/migration/1x-to-2x/).</span></span>

## <a name="breaking-changes"></a><span data-ttu-id="c5b96-120">Modifiche di interruzione</span><span class="sxs-lookup"><span data-stu-id="c5b96-120">Breaking Changes</span></span>

<span data-ttu-id="c5b96-121">È stato reindirizzato opportunità per perfezionare in modo significativo l'API esistenti e i comportamenti di 2.0.</span><span class="sxs-lookup"><span data-stu-id="c5b96-121">We have taken the opportunity to significantly refine our existing APIs and behaviors in 2.0.</span></span> <span data-ttu-id="c5b96-122">Esistono alcuni miglioramenti che possono richiedere la modifica di codice dell'applicazione esistente, anche se si ritiene che per la maggior parte delle applicazioni l'impatto è bassa, nella maggior parte dei casi che richiedono solo la ricompilazione e modifiche interattiva minime per sostituire le API obsolete.</span><span class="sxs-lookup"><span data-stu-id="c5b96-122">There are a few improvements that can require modifying existing application code, although we believe that for the majority of applications the impact will be low, in most cases requiring just recompilation and minimal guided changes to replace obsolete APIs.</span></span>

### <a name="new-way-of-getting-application-services"></a><span data-ttu-id="c5b96-123">Nuova modalità di acquisizione di servizi delle applicazioni</span><span class="sxs-lookup"><span data-stu-id="c5b96-123">New way of getting application services</span></span>

<span data-ttu-id="c5b96-124">Il modello consigliato per le applicazioni web ASP.NET Core è stato aggiornato per 2.0 in modo che ha superato la logica della fase di progettazione che EF principali utilizzati in 1. x.</span><span class="sxs-lookup"><span data-stu-id="c5b96-124">The recommended pattern for ASP.NET Core web applications has been updated for 2.0 in a way that broke the design-time logic EF Core used in 1.x.</span></span> <span data-ttu-id="c5b96-125">In precedenza in fase di progettazione EF Core tenta di richiamare `Startup.ConfigureServices` direttamente per accedere ai provider di servizi dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c5b96-125">Previously at design-time, EF Core would try to invoke `Startup.ConfigureServices` directly in order to access the application's service provider.</span></span> <span data-ttu-id="c5b96-126">In ASP.NET 2.0 Core configurazione viene inizializzata di fuori del `Startup` classe.</span><span class="sxs-lookup"><span data-stu-id="c5b96-126">In ASP.NET Core 2.0, Configuration is initialized outside of the `Startup` class.</span></span> <span data-ttu-id="c5b96-127">Applicazioni che usano in genere EF Core accedere relativa stringa di connessione dalla configurazione, pertanto `Startup` da sola non è più sufficiente.</span><span class="sxs-lookup"><span data-stu-id="c5b96-127">Applications using EF Core typically access their connection string from Configuration, so `Startup` by itself is no longer sufficient.</span></span> <span data-ttu-id="c5b96-128">Se si aggiorna un'applicazione di ASP.NET Core 1. x, si verifichi l'errore seguente quando si utilizzano gli strumenti di Entity Framework Core.</span><span class="sxs-lookup"><span data-stu-id="c5b96-128">If you upgrade an ASP.NET Core 1.x application, you may receive the following error when using the EF Core tools.</span></span>

> <span data-ttu-id="c5b96-129">Nessun costruttore senza parametri è stato trovato in 'ApplicationContext'.</span><span class="sxs-lookup"><span data-stu-id="c5b96-129">No parameterless constructor was found on 'ApplicationContext'.</span></span> <span data-ttu-id="c5b96-130">Aggiungere un costruttore senza parametri 'ApplicationContext' o aggiungere un'implementazione di ' IDesignTimeDbContextFactory&lt;ApplicationContext&gt;' nello stesso assembly come 'ApplicationContext'</span><span class="sxs-lookup"><span data-stu-id="c5b96-130">Either add a parameterless constructor to 'ApplicationContext' or add an implementation of 'IDesignTimeDbContextFactory&lt;ApplicationContext&gt;' in the same assembly as 'ApplicationContext'</span></span>

<span data-ttu-id="c5b96-131">Modello predefinito di ASP.NET Core 2.0 è stato aggiunto un nuovo hook in fase di progettazione.</span><span class="sxs-lookup"><span data-stu-id="c5b96-131">A new design-time hook has been added in ASP.NET Core 2.0's default template.</span></span> <span data-ttu-id="c5b96-132">Il metodo statico `Program.BuildWebHost` consente principale di Entity Framework accedere ai provider di servizi dell'applicazione in fase di progettazione.</span><span class="sxs-lookup"><span data-stu-id="c5b96-132">The static `Program.BuildWebHost` method enables EF Core to access the application's service provider at design time.</span></span> <span data-ttu-id="c5b96-133">Se si esegue l'aggiornamento di un'applicazione di ASP.NET Core 1. x, sarà necessario aggiornarla `Program` classe per essere simile al seguente.</span><span class="sxs-lookup"><span data-stu-id="c5b96-133">If you are upgrading an ASP.NET Core 1.x application, you will need to update you `Program` class to resemble the following.</span></span>

``` csharp
using Microsoft.AspNetCore;
using Microsoft.AspNetCore.Hosting;

namespace AspNetCoreDotNetCore2._0App
{
    public class Program
    {
        public static void Main(string[] args)
        {
            BuildWebHost(args).Run();
        }

        public static IWebHost BuildWebHost(string[] args) =>
            WebHost.CreateDefaultBuilder(args)
                .UseStartup<Startup>()
                .Build();
    }
}
```

### <a name="idbcontextfactory-renamed"></a><span data-ttu-id="c5b96-134">IDbContextFactory rinominato</span><span class="sxs-lookup"><span data-stu-id="c5b96-134">IDbContextFactory renamed</span></span>

<span data-ttu-id="c5b96-135">Per supportare modelli di applicazione diverse e fornire agli utenti maggiore controllo sulla modalità loro `DbContext` viene utilizzato in fase di progettazione, è disponibile, in passato, purché il `IDbContextFactory<TContext>` interfaccia.</span><span class="sxs-lookup"><span data-stu-id="c5b96-135">In order to support diverse application patterns and give users more control over how their `DbContext` is used at design time, we have, in the past, provided the `IDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="c5b96-136">In fase di progettazione, gli strumenti di Entity Framework Core verranno individuata implementazioni di questa interfaccia nel progetto e utilizzarlo per creare `DbContext` oggetti.</span><span class="sxs-lookup"><span data-stu-id="c5b96-136">At design-time, the EF Core tools will discover implementations of this interface in your project and use it to create `DbContext` objects.</span></span>

<span data-ttu-id="c5b96-137">Questa interfaccia ha un nome molto generale che indurre gli utenti a provare a utilizzarlo nuovamente per altri `DbContext`-creazione di scenari.</span><span class="sxs-lookup"><span data-stu-id="c5b96-137">This interface had a very general name which mislead some users to try re-using it for other `DbContext`-creating scenarios.</span></span> <span data-ttu-id="c5b96-138">Sono state sprovvista se gli strumenti di Entity Framework ha cercato di utilizzare la relativa implementazione in fase di progettazione e ha i comandi come `Update-Database` o `dotnet ef database update` esito negativo.</span><span class="sxs-lookup"><span data-stu-id="c5b96-138">They were caught off guard when the EF Tools then tried to use their implementation at design-time and caused commands like `Update-Database` or `dotnet ef database update` to fail.</span></span>

<span data-ttu-id="c5b96-139">Per poter comunicare la semantica della fase di progettazione sicura di questa interfaccia, è stata rinominata in `IDesignTimeDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="c5b96-139">In order to communicate the strong design-time semantics of this interface, we have renamed it to `IDesignTimeDbContextFactory<TContext>`.</span></span>

<span data-ttu-id="c5b96-140">Per 2.0 rilasciare il `IDbContextFactory<TContext>` esiste ancora, ma è contrassegnato come obsoleto.</span><span class="sxs-lookup"><span data-stu-id="c5b96-140">For the 2.0 release the `IDbContextFactory<TContext>` still exists but is marked as obsolete.</span></span>

### <a name="dbcontextfactoryoptions-removed"></a><span data-ttu-id="c5b96-141">DbContextFactoryOptions rimosso</span><span class="sxs-lookup"><span data-stu-id="c5b96-141">DbContextFactoryOptions removed</span></span>

<span data-ttu-id="c5b96-142">A causa di modifiche di ASP.NET 2.0 Core descritte in precedenza, si è scoperto che `DbContextFactoryOptions` non stato non è più necessario nel nuovo `IDesignTimeDbContextFactory<TContext>` interfaccia.</span><span class="sxs-lookup"><span data-stu-id="c5b96-142">Because of the ASP.NET Core 2.0 changes described above, we found that `DbContextFactoryOptions` was no longer needed on the new `IDesignTimeDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="c5b96-143">Di seguito sono disponibili le alternative, che è consigliabile usare invece.</span><span class="sxs-lookup"><span data-stu-id="c5b96-143">Here are the alternatives you should be using instead.</span></span>

<span data-ttu-id="c5b96-144">DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="c5b96-144">DbContextFactoryOptions</span></span> | <span data-ttu-id="c5b96-145">Alternativa</span><span class="sxs-lookup"><span data-stu-id="c5b96-145">Alternative</span></span>
--- | ---
<span data-ttu-id="c5b96-146">ApplicationBasePath</span><span class="sxs-lookup"><span data-stu-id="c5b96-146">ApplicationBasePath</span></span> | <span data-ttu-id="c5b96-147">AppContext.BaseDirectory</span><span class="sxs-lookup"><span data-stu-id="c5b96-147">AppContext.BaseDirectory</span></span>
<span data-ttu-id="c5b96-148">ContentRootPath</span><span class="sxs-lookup"><span data-stu-id="c5b96-148">ContentRootPath</span></span> | <span data-ttu-id="c5b96-149">Directory.GetCurrentDirectory()</span><span class="sxs-lookup"><span data-stu-id="c5b96-149">Directory.GetCurrentDirectory()</span></span>
<span data-ttu-id="c5b96-150">EnvironmentName</span><span class="sxs-lookup"><span data-stu-id="c5b96-150">EnvironmentName</span></span> | <span data-ttu-id="c5b96-151">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span><span class="sxs-lookup"><span data-stu-id="c5b96-151">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span></span>

### <a name="design-time-working-directory-changed"></a><span data-ttu-id="c5b96-152">Directory di lavoro in fase di progettazione modificata</span><span class="sxs-lookup"><span data-stu-id="c5b96-152">Design-time working directory changed</span></span>

<span data-ttu-id="c5b96-153">Le modifiche principali di ASP.NET 2.0 è inoltre necessario directory di lavoro utilizzata da `dotnet ef` per allinearlo con la directory di lavoro usata da Visual Studio quando si esegue l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c5b96-153">The ASP.NET Core 2.0 changes also required the working directory used by `dotnet ef` to align with the working directory used by Visual Studio when running your application.</span></span> <span data-ttu-id="c5b96-154">Un effetto collaterale osservabile di questo oggetto è di SQLite i nomi di file sono ora relativa rispetto alla directory del progetto e non la directory di output come alle precedenti.</span><span class="sxs-lookup"><span data-stu-id="c5b96-154">One observable side effect of this is that SQLite filenames are now relative to the project directory and not the output directory like they used to be.</span></span>

### <a name="ef-core-20-requires-a-20-database-provider"></a><span data-ttu-id="c5b96-155">Core EF 2.0 richiede un provider di 2.0 database</span><span class="sxs-lookup"><span data-stu-id="c5b96-155">EF Core 2.0 requires a 2.0 database provider</span></span>

<span data-ttu-id="c5b96-156">Per Entity Framework Core 2.0 sono stati apportati molti semplificazione e miglioramenti nei provider di database modalità di lavoro.</span><span class="sxs-lookup"><span data-stu-id="c5b96-156">For EF Core 2.0 we have made many simplifications and improvements in the way database providers work.</span></span> <span data-ttu-id="c5b96-157">Ciò significa che i provider 1.0 e 1.1.x non funzioneranno con Entity Framework Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="c5b96-157">This means that 1.0.x and 1.1.x providers will not work with EF Core 2.0.</span></span>

<span data-ttu-id="c5b96-158">I provider di SQL Server e SQLite vengono forniti dal team di Entity Framework e le 2.0 versioni saranno disponibili come parte di 2.0 rilasciare.</span><span class="sxs-lookup"><span data-stu-id="c5b96-158">The SQL Server and SQLite providers are shipped by the EF team and 2.0 versions will be available as part of the 2.0 release.</span></span> <span data-ttu-id="c5b96-159">I provider di terze parti open source per [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), e [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) in corso l'aggiornamento per 2.0.</span><span class="sxs-lookup"><span data-stu-id="c5b96-159">The open-source third party providers for [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), and [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) are being updated for 2.0.</span></span> <span data-ttu-id="c5b96-160">Per tutti gli altri provider, contattare il writer di provider.</span><span class="sxs-lookup"><span data-stu-id="c5b96-160">For all other providers, please contact the provider writer.</span></span>

### <a name="logging-and-diagnostics-events-have-changed"></a><span data-ttu-id="c5b96-161">Sono stati modificati gli eventi di registrazione e diagnostica</span><span class="sxs-lookup"><span data-stu-id="c5b96-161">Logging and Diagnostics events have changed</span></span>

<span data-ttu-id="c5b96-162">Nota: queste modifiche dovrebbero influire gran parte del codice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c5b96-162">Note: these changes should not impact most application code.</span></span>

<span data-ttu-id="c5b96-163">Gli ID degli eventi per i messaggi inviati a un [ILogger](https://github.com/aspnet/Logging/blob/dev/src/Microsoft.Extensions.Logging.Abstractions/ILogger.cs) sono stati modificati in 2.0.</span><span class="sxs-lookup"><span data-stu-id="c5b96-163">The event IDs for messages sent to an [ILogger](https://github.com/aspnet/Logging/blob/dev/src/Microsoft.Extensions.Logging.Abstractions/ILogger.cs) have changed in 2.0.</span></span> <span data-ttu-id="c5b96-164">ID evento ora sono univoci per il codice di Entity Framework Core.</span><span class="sxs-lookup"><span data-stu-id="c5b96-164">The event IDs are now unique across EF Core code.</span></span> <span data-ttu-id="c5b96-165">Questi messaggi ora anche seguono il modello standard per la registrazione strutturato utilizzato, ad esempio, MVC.</span><span class="sxs-lookup"><span data-stu-id="c5b96-165">These messages now also follow the standard pattern for structured logging used by, for example, MVC.</span></span>

<span data-ttu-id="c5b96-166">Categorie di logger sono stato modificato.</span><span class="sxs-lookup"><span data-stu-id="c5b96-166">Logger categories have also changed.</span></span> <span data-ttu-id="c5b96-167">Viene visualizzato tramite un set noto di categorie [DbLoggerCategory](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/DbLoggerCategory.cs).</span><span class="sxs-lookup"><span data-stu-id="c5b96-167">There is now a well-known set of categories accessed through [DbLoggerCategory](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/DbLoggerCategory.cs).</span></span>

<span data-ttu-id="c5b96-168">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) eventi ora utilizzano gli stessi nomi di ID evento corrispondenti `ILogger` messaggi.</span><span class="sxs-lookup"><span data-stu-id="c5b96-168">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) events now use the same event ID names as the corresponding `ILogger` messages.</span></span> <span data-ttu-id="c5b96-169">I payload dell'evento sono tutti i tipi nominali derivati da [EventData](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/EventData.cs).</span><span class="sxs-lookup"><span data-stu-id="c5b96-169">The event payloads are all nominal types derived from [EventData](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/EventData.cs).</span></span>

<span data-ttu-id="c5b96-170">Gli ID degli eventi, tipi di payload e le categorie sono documentate nel [CoreEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/CoreEventId.cs) e [RelationalEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore.Relational/Diagnostics/RelationalEventId.cs) classi.</span><span class="sxs-lookup"><span data-stu-id="c5b96-170">Event IDs, payload types, and categories are documented in the [CoreEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/CoreEventId.cs) and the [RelationalEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore.Relational/Diagnostics/RelationalEventId.cs) classes.</span></span>

<span data-ttu-id="c5b96-171">Gli ID sono stati spostati anche da Microsoft.EntityFrameworkCore.Infraestructure Microsoft.EntityFrameworkCore.Diagnostics nuovo spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="c5b96-171">IDs have also moved from Microsoft.EntityFrameworkCore.Infraestructure to the new Microsoft.EntityFrameworkCore.Diagnostics namespace.</span></span>

### <a name="ef-core-relational-metadata-api-changes"></a><span data-ttu-id="c5b96-172">Modifiche ai metadati relazionali API Core EF</span><span class="sxs-lookup"><span data-stu-id="c5b96-172">EF Core relational metadata API changes</span></span>

<span data-ttu-id="c5b96-173">Core EF 2.0 ora creerà un altro [IModel](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IModel.cs) per ogni provider diversi in uso.</span><span class="sxs-lookup"><span data-stu-id="c5b96-173">EF Core 2.0 will now build a different [IModel](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IModel.cs) for each different provider being used.</span></span> <span data-ttu-id="c5b96-174">Si tratta in genere trasparente all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c5b96-174">This is usually transparent to the application.</span></span> <span data-ttu-id="c5b96-175">Questo è facilitata una semplificazione dell'API dei metadati di livello inferiore in modo che qualsiasi accesso a _concetti comuni di metadati relazionali_ viene sempre eseguita tramite una chiamata a `.Relational` anziché `.SqlServer`, `.Sqlite`e così via. Ad esempio, 1.1.x codice simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="c5b96-175">This has facilitated a simplification of lower-level metadata APIs such that any access to _common relational metadata concepts_ is always made through a call to `.Relational` instead of `.SqlServer`, `.Sqlite`, etc. For example, 1.1.x code like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).SqlServer().TableName;
```

<span data-ttu-id="c5b96-176">Deve essere scritto ora simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="c5b96-176">Should now be written like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).Relational().TableName;
```

<span data-ttu-id="c5b96-177">Anziché utilizzare i metodi, ad esempio `ForSqlServerToTable`, metodi di estensione sono ora disponibili per scrivere il codice condizionale in base al provider corrente in uso.</span><span class="sxs-lookup"><span data-stu-id="c5b96-177">Instead of using methods like `ForSqlServerToTable`, extension methods are now available to write conditional code based on the current provider in use.</span></span> <span data-ttu-id="c5b96-178">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="c5b96-178">For example:</span></span>

```C#
modelBuilder.Entity<User>().ToTable(
    Database.IsSqlServer() ? "SqlServerName" : "OtherName");
```

<span data-ttu-id="c5b96-179">Si noti che questa modifica si applica solo ai API/metadati definito per _tutti_ provider relazionale.</span><span class="sxs-lookup"><span data-stu-id="c5b96-179">Note that this change only applies to APIs/metadata that is defined for _all_ relational providers.</span></span> <span data-ttu-id="c5b96-180">Le API e i metadati rimane invariato quando è specifica per un singolo provider.</span><span class="sxs-lookup"><span data-stu-id="c5b96-180">The API and metadata remains the same when it is specific to only a single provider.</span></span> <span data-ttu-id="c5b96-181">Ad esempio, gli indici cluster sono specifici di SQL Server, in modo `ForSqlServerIsClustered` e `.SqlServer().IsClustered()` deve comunque essere utilizzato.</span><span class="sxs-lookup"><span data-stu-id="c5b96-181">For example, clustered indexes are specific to SQL Sever, so `ForSqlServerIsClustered` and  `.SqlServer().IsClustered()` must still be used.</span></span>

### <a name="dont-take-control-of-the-ef-service-provider"></a><span data-ttu-id="c5b96-182">Non assumere il controllo del provider di servizi di Entity Framework</span><span class="sxs-lookup"><span data-stu-id="c5b96-182">Don’t take control of the EF service provider</span></span>

<span data-ttu-id="c5b96-183">Utilizza un oggetto interno EF Core `IServiceProvider` (ad esempio un contenitore dipendenza injection) per l'implementazione interna.</span><span class="sxs-lookup"><span data-stu-id="c5b96-183">EF Core uses an internal `IServiceProvider` (i.e. a dependency injection container) for its internal implementation.</span></span> <span data-ttu-id="c5b96-184">Le applicazioni dovrebbero consentire di EF Core creare e gestire questo provider, tranne in casi particolari.</span><span class="sxs-lookup"><span data-stu-id="c5b96-184">Applications should allow EF Core to create and manage this provider except in special cases.</span></span> <span data-ttu-id="c5b96-185">Considerare la rimozione di tutte le chiamate a `UseInternalServiceProvider`.</span><span class="sxs-lookup"><span data-stu-id="c5b96-185">Strongly consider removing any calls to `UseInternalServiceProvider`.</span></span> <span data-ttu-id="c5b96-186">Se un'applicazione è necessario chiamare `UseInternalServiceProvider`, quindi provare a [un problema di archiviazione](https://github.com/aspnet/EntityFramework/Issues) in modo sarà possibile esaminare altri modi per gestire lo scenario.</span><span class="sxs-lookup"><span data-stu-id="c5b96-186">If an application does need to call `UseInternalServiceProvider`, then please consider [filing an issue](https://github.com/aspnet/EntityFramework/Issues) so we can investigate other ways to handle your scenario.</span></span>

<span data-ttu-id="c5b96-187">La chiamata `AddEntityFramework`, `AddEntityFrameworkSqlServer`, e così via. non è richiesto dal codice dell'applicazione a meno che non `UseInternalServiceProvider` viene anche chiamato.</span><span class="sxs-lookup"><span data-stu-id="c5b96-187">Calling `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. is not required by application code unless `UseInternalServiceProvider` is also called.</span></span> <span data-ttu-id="c5b96-188">Rimuovere le eventuali chiamate al `AddEntityFramework` o `AddEntityFrameworkSqlServer`e così via `AddDbContext` deve ancora essere utilizzata nello stesso modo come prima.</span><span class="sxs-lookup"><span data-stu-id="c5b96-188">Remove any existing calls to `AddEntityFramework` or `AddEntityFrameworkSqlServer`, etc. `AddDbContext` should still be used in the same way as before.</span></span>

### <a name="in-memory-databases-must-be-named"></a><span data-ttu-id="c5b96-189">Database in memoria devono essere denominati</span><span class="sxs-lookup"><span data-stu-id="c5b96-189">In-memory databases must be named</span></span>

<span data-ttu-id="c5b96-190">È stato rimosso il database in memoria senza nome globale e invece tutti i database in memoria devono essere denominati.</span><span class="sxs-lookup"><span data-stu-id="c5b96-190">The global unnamed in-memory database has been removed and instead all in-memory databases must be named.</span></span> <span data-ttu-id="c5b96-191">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="c5b96-191">For example:</span></span>

``` csharp
optionsBuilder.UseInMemoryDatabase("MyDatabase");
```

<span data-ttu-id="c5b96-192">Si crea o si utilizza un database con nome "MyDatabase".</span><span class="sxs-lookup"><span data-stu-id="c5b96-192">This creates/uses a database with the name “MyDatabase”.</span></span> <span data-ttu-id="c5b96-193">Se `UseInMemoryDatabase` viene chiamato nuovamente con lo stesso nome, verrà utilizzato lo stesso database in memoria, in modo che possa essere condiviso da più istanze di contesto.</span><span class="sxs-lookup"><span data-stu-id="c5b96-193">If `UseInMemoryDatabase` is called again with the same name, then the same in-memory database will be used, allowing it to be shared by multiple context instances.</span></span>

### <a name="read-only-api-changes"></a><span data-ttu-id="c5b96-194">Modifiche all'API di sola lettura</span><span class="sxs-lookup"><span data-stu-id="c5b96-194">Read-only API changes</span></span>

<span data-ttu-id="c5b96-195">`IsReadOnlyBeforeSave`, `IsReadOnlyAferSave`, e `IsStoreGeneratedAlways` sono stati obsoleto e sostituito con [BeforeSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L39) e [AfterSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L55).</span><span class="sxs-lookup"><span data-stu-id="c5b96-195">`IsReadOnlyBeforeSave`, `IsReadOnlyAferSave`, and `IsStoreGeneratedAlways` have been obsoleted and replaced with [BeforeSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L39) and [AfterSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L55).</span></span> <span data-ttu-id="c5b96-196">Questi comportamenti si applicano a qualsiasi proprietà (non solo proprietà generate dall'archivio) e determinare come il valore della proprietà deve essere utilizzato durante l'inserimento in una riga di database (`BeforeSaveBehavior`) o quando l'aggiornamento di un oggetto esistente database riga (`AfterSaveBehavior`).</span><span class="sxs-lookup"><span data-stu-id="c5b96-196">These behaviors apply to any property (not only store-generated properties) and determine how the value of the property should be used when inserting into a database row (`BeforeSaveBehavior`) or when updating an existing database row (`AfterSaveBehavior`).</span></span>

<span data-ttu-id="c5b96-197">Le proprietà contrassegnate come [ValueGenerated.OnAddOrUpdate](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/ValueGenerated.cs) (ad esempio, per le colonne calcolate) per impostazione predefinita ignorerà qualsiasi valore attualmente impostato sulla proprietà.</span><span class="sxs-lookup"><span data-stu-id="c5b96-197">Properties marked as [ValueGenerated.OnAddOrUpdate](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/ValueGenerated.cs) (e.g. for computed columns) will by default ignore any value currently set on the property.</span></span> <span data-ttu-id="c5b96-198">Ciò significa che un valore generato dall'archivio verrà sempre ottenuto indipendentemente dal fatto di impostare o modificato in entità rilevata di qualsiasi valore.</span><span class="sxs-lookup"><span data-stu-id="c5b96-198">This means that a store-generated value will always be obtained regardless of whether any value has been set or modified on the tracked entity.</span></span> <span data-ttu-id="c5b96-199">Può essere modificato impostando un altro `Before\AfterSaveBehavior`.</span><span class="sxs-lookup"><span data-stu-id="c5b96-199">This can be changed by setting a different `Before\AfterSaveBehavior`.</span></span>

### <a name="new-clientsetnull-delete-behavior"></a><span data-ttu-id="c5b96-200">Nuovo comportamento di eliminazione ClientSetNull</span><span class="sxs-lookup"><span data-stu-id="c5b96-200">New ClientSetNull delete behavior</span></span>

<span data-ttu-id="c5b96-201">Nelle versioni precedenti, [DeleteBehavior.Restrict](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/DeleteBehavior.cs) ha un comportamento per le entità rilevato dal contesto che più chiusa corrispondente `SetNull` semantica.</span><span class="sxs-lookup"><span data-stu-id="c5b96-201">In previous releases, [DeleteBehavior.Restrict](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/DeleteBehavior.cs) had a behavior for entities tracked by the context that more closed matched `SetNull` semantics.</span></span> <span data-ttu-id="c5b96-202">In Entity Framework Core 2.0, un nuovo `ClientSetNull` comportamento è stato introdotto come il valore predefinito per le relazioni facoltative.</span><span class="sxs-lookup"><span data-stu-id="c5b96-202">In EF Core 2.0, a new `ClientSetNull` behavior has been introduced as the default for optional relationships.</span></span> <span data-ttu-id="c5b96-203">Questo comportamento è `SetNull` semantica per le entità rilevate e `Restrict` comportamento per i database creati mediante EF Core.</span><span class="sxs-lookup"><span data-stu-id="c5b96-203">This behavior has `SetNull` semantics for tracked entities and `Restrict` behavior for databases created using EF Core.</span></span> <span data-ttu-id="c5b96-204">Nella nostra esperienza, questi sono i comportamenti previsti/utili per le entità rilevate e il database.</span><span class="sxs-lookup"><span data-stu-id="c5b96-204">In our experience, these are the most expected/useful behaviors for tracked entities and the database.</span></span> <span data-ttu-id="c5b96-205">`DeleteBehavior.Restrict`viene ora applicata per le entità rilevate quando viene impostate per le relazioni facoltative.</span><span class="sxs-lookup"><span data-stu-id="c5b96-205">`DeleteBehavior.Restrict` is now honored for tracked entities when set for optional relationships.</span></span>

### <a name="provider-design-time-packages-removed"></a><span data-ttu-id="c5b96-206">Pacchetti in fase di progettazione provider rimossi</span><span class="sxs-lookup"><span data-stu-id="c5b96-206">Provider design-time packages removed</span></span>

<span data-ttu-id="c5b96-207">Il `Microsoft.EntityFrameworkCore.Relational.Design` pacchetto è stato rimosso.</span><span class="sxs-lookup"><span data-stu-id="c5b96-207">The `Microsoft.EntityFrameworkCore.Relational.Design` package has been removed.</span></span> <span data-ttu-id="c5b96-208">Il relativo contenuto sono stato consolidato in `Microsoft.EntityFrameworkCore.Relational` e `Microsoft.EntityFrameworkCore.Design`.</span><span class="sxs-lookup"><span data-stu-id="c5b96-208">It's contents were consolidated into `Microsoft.EntityFrameworkCore.Relational` and `Microsoft.EntityFrameworkCore.Design`.</span></span>

<span data-ttu-id="c5b96-209">Propaga nei pacchetti in fase di progettazione del provider.</span><span class="sxs-lookup"><span data-stu-id="c5b96-209">This propagates into the provider design-time packages.</span></span> <span data-ttu-id="c5b96-210">Tali pacchetti (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`e così via) sono state rimosse e il relativo contenuto consolidati nei pacchetti provider principale.</span><span class="sxs-lookup"><span data-stu-id="c5b96-210">Those packages (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) were removed and their contents consolidated into the main provider packages.</span></span>

<span data-ttu-id="c5b96-211">Per abilitare `Scaffold-DbContext` o `dotnet ef dbcontext scaffold` EF Core 2.0, è sufficiente fanno riferimento al pacchetto unico provider:</span><span class="sxs-lookup"><span data-stu-id="c5b96-211">To enable `Scaffold-DbContext` or `dotnet ef dbcontext scaffold` in EF Core 2.0, you only need to reference the single provider package:</span></span>

``` xml
<PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer"
    Version="2.0.0" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Tools"
    Version="2.0.0"
    PrivateAssets="All" />
<DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet"
    Version="2.0.0" />
```
